ncid = netcdf.open('./EBAF4_2/CERES_EBAF-TOA_Ed4.2_Subset_200301-202312.nc'); ncid_elev = netcdf.open('./GMTED2010_15n240_1000deg.nc'); ncid_4K_Pattern = netcdf.open('./Warming_pattern_4K_IPCC_fig4_31.nc');DeltaT_4K_IPCC = double(netcdf.getVar(ncid_4K_Pattern,3));ncid_2K_Pattern = netcdf.open('./Warming_pattern_2K_IPCC_fig4_31.nc');DeltaT_2K_IPCC = double(netcdf.getVar(ncid_2K_Pattern,3));Load_CMIP6_4xCO2Load_ztrop;Lon_EBAF = double(netcdf.getVar(ncid,0));Lon_EBAF2 = [Lon_EBAF; 360.5];Lat_EBAF = double(netcdf.getVar(ncid,1));Time_EBAF = netcdf.getVar(ncid,2);S_out_AllSky_EBAF = netcdf.getVar(ncid,3);L_out_AllSky_EBAF = netcdf.getVar(ncid,4);Net_out_AllSky_EBAF = netcdf.getVar(ncid,5);S_out_ClearSky_EBAF = netcdf.getVar(ncid,6);L_out_ClearSky_EBAF = netcdf.getVar(ncid,7);Net_out_ClearSky_EBAF = netcdf.getVar(ncid,8);S_in_EBAF = netcdf.getVar(ncid,9);Cloud_Amount_EBAF = netcdf.getVar(ncid,10);Cloud_Press_EBAF = netcdf.getVar(ncid,11);Cloud_Temp_EBAF = netcdf.getVar(ncid,12);Cloud_VisOpticalDepth_EBAF = netcdf.getVar(ncid,13);ncid_ERA5 = netcdf.open('./ERA5_2003_2023.nc');T_2m_ERA5 = netcdf.getVar(ncid_ERA5,4);DPT_2m_ERA5 = netcdf.getVar(ncid_ERA5,3);Surface_Pressure_ERA5 = netcdf.getVar(ncid_ERA5,6);Elevation = double(netcdf.getVar(ncid_elev,5))/1000.0; %Elevation in km%These open as int16 type and need multiplying and offsetting to convert to double: scale factor * initial + offsetT_2m_ERA5 = 0.0017172688685352228*double(T_2m_ERA5) + 259.2086292806048;DPT_2m_ERA5 = 0.001573121475117975*double(DPT_2m_ERA5) + 250.9692756951218;Surface_Pressure_ERA5 = 0.8629129956472311*double(Surface_Pressure_ERA5) + 76378.46112162717;[size_lon_EBAF, size_lat_EBAF, size_time_EBAF] = size(S_out_ClearSky_EBAF);for k = 1:252 %2000 to 2020 - need to change data in file    k    T_ERA5_prime(:,:,k) = imresize(T_2m_ERA5(:,:,k),[360 180],'bicubic');    DPT_ERA5_prime(:,:,k) = imresize(DPT_2m_ERA5(:,:,k),[360 180],'bicubic');    P_ERA5_prime(:,:,k) = imresize(Surface_Pressure_ERA5(:,:,k),[360 180],'bicubic');endfor i=1:size_lon_EBAF    i    for j = 1:size_lat_EBAF        for k = 1:252            T_ERA5(i,j,k)=T_ERA5_prime(i,181-j,k);            DPT_ERA5(i,j,k)=DPT_ERA5_prime(i,181-j,k);            P_ERA5(i,j,k)=P_ERA5_prime(i,181-j,k);        end    endend%ncid_ERA5_ensemble = netcdf.open('./ERA5_2003_2023_ensemble.nc');%T_2m_ERA5_ensemble = netcdf.getVar(ncid_ERA5_ensemble,5);%DPT_2m_ERA5_ensemble = netcdf.getVar(ncid_ERA5_ensemble,4);%Surface_Pressure_ERA5_ensemble = netcdf.getVar(ncid_ERA5_ensemble,6);%T_2m_ERA5_ensemble = 0.001716846727254184*double(T_2m_ERA5_ensemble) + 258.9071081904059;%DPT_2m_ERA5_ensemble = 0.0015852827763362066*double(DPT_2m_ERA5_ensemble) + 251.13407979513528;%Surface_Pressure_ERA5_ensemble = 0.8226364126661376*double(Surface_Pressure_ERA5_ensemble) + 77780.28985366867;%for k = 1:252 %2000 to 2020 - need to change data in file%    k%    for l = 1:10%        T_ERA5_ensemble_prime(:,:,l,k) = imresize(T_2m_ERA5_ensemble(:,:,l,k),[360 180]);%        DPT_ERA5_ensemble_prime(:,:,l,k) = imresize(DPT_2m_ERA5_ensemble(:,:,l,k),[360 180]);%        P_ERA5_ensemble_prime(:,:,l,k) = imresize(Surface_Pressure_ERA5_ensemble(:,:,l,k),[360 180]);%    end%end%for i=1:size_lon_EBAF%    i%    for j = 1:size_lat_EBAF%        for l=1:10 %ensemble members%            for k = 1:252%                T_ERA5_ensemble(i,j,l,k)=T_ERA5_ensemble_prime(i,181-j,l,k);%                DPT_ERA5_ensemble(i,j,l,k)=DPT_ERA5_ensemble_prime(i,181-j,l,k);%                P_ERA5_ensemble(i,j,l,k)=P_ERA5_ensemble_prime(i,181-j,l,k);%            end%        end%    end%end%clear('T_ERA5_ensemble_prime');%clear('DPT_ERA5_ensemble_prime');%clear('P_ERA5_ensemble_prime');%clear('T_2m_ERA5_ensemble');%clear('DPT_2m_ERA5_ensemble');%clear('Surface_Pressure_2m_ERA5_ensemble');%T_ERA5 = squeeze(T_ERA5_ensemble(:,:,5,:));%DPT_ERA5 = squeeze(DPT_ERA5_ensemble(:,:,5,:));%P_ERA5 = squeeze(P_ERA5_ensemble(:,:,5,:));%Only works when RH > 50 % - so not everywhere%%%%%%%%RH_ERA5 = 100 - 5*(T_2m_ERA5 - DPT_2m_ERA5);B1_RH = 243.04;A1_RH = 17.625;%Adapt to only get the 180x360x252 array of RH values...for i=1:size_lon_EBAF    i    for j = 1:size_lat_EBAF        for k = 1:252            RH_ERA5(i,j,k) = 50.0; %initial guess            for l = 1:50                                    %RH_ERA5(i,j,k) = RH_ERA5(i,j,k) + 1.0*(DPT_2m_ERA5(4*i-1,4*(181-j)-1,1,k+12)-273.15 - (B1_RH*(log(RH_ERA5(i,j,k)/100.0) + A1_RH*(T_2m_ERA5(4*i-1,4*(181-j)-1,1,k+12)-273.15)/(B1_RH + (T_2m_ERA5(4*i-1,4*(181-j)-1,1,k+12)-273.15)) )) / (A1_RH - (log(RH_ERA5(i,j,k)/100.0)) - A1_RH*(T_2m_ERA5(4*i-1,4*(181-j)-1,1,k+12)-273.15)/(B1_RH + (T_2m_ERA5(4*i-1,4*(181-j)-1,1,k+12)-273.15))) );                    %T_ERA5(i,j,k) = T_2m_ERA5(4*i-1,4*(181-j)-1,1,k+12);                    %P_ERA5(i,j,k) = Surface_Pressure_ERA5(4*i-1,4*(181-j)-1,1,k+12);                                        RH_ERA5(i,j,k) = RH_ERA5(i,j,k) + 1.0*(DPT_ERA5(i,j,k)-273.15 - (B1_RH*(log(RH_ERA5(i,j,k)/100.0) + A1_RH*(T_ERA5(i,j,k)-273.15)/(B1_RH + (T_ERA5(i,j,k)-273.15)) )) / (A1_RH - (log(RH_ERA5(i,j,k)/100.0)) - A1_RH*(T_ERA5(i,j,k)-273.15)/(B1_RH + (T_ERA5(i,j,k)-273.15))) );                                                if(RH_ERA5(i,j,k) > 100.0)                    RH_ERA5(i,j,k) = 100.0;                end                if(RH_ERA5(i,j,k) < 0.0)                    RH_ERA5(i,j,k) = 0.0;                end            end        end    endendsize_array_EBAF = size_lat_EBAF;ncid_Land_Sea_Mask = netcdf.open('./EBAF4_2/HadISST1_SST_update.nc');SST_for_mask = netcdf.getVar(ncid_Land_Sea_Mask,4);%Latitude and longitude coordinates differ for maskfor i=1:size_lon_EBAF    for j=1:size_lat_EBAF        if(i<180.5)            if(SST_for_mask(i,j,9 ) < -100)                Land_Mask(180+i,181-j) = 1;            end            if(SST_for_mask(i,j,9 ) > -100)                Land_Mask(180+i,181-j) = 0;            end            Elevation_GMTED2010(i, j) = Elevation(180+i,j);        end        if(i>180.5)            if(SST_for_mask(i,j,9 ) < -100)                Land_Mask(i-180,181-j) = 1;            end            if(SST_for_mask(i,j,9 ) > -100)                Land_Mask(i-180,181-j) = 0;            end            Elevation_GMTED2010(i, j) = Elevation(i-180,j);        end    endendR_Earth = 6371000.0 % Radius of Planet earth in mArea_Earth = 4*pi()*R_Earth^2;phi_rad_EBAF = deg2rad(linspace(-89.5, 89.5, size_lat_EBAF))Area_EBAF_zonal = (0.5*Area_Earth * ( (1-sin(phi_rad_EBAF-0.5*pi()/size_lat_EBAF)) - (1-sin(phi_rad_EBAF+0.5*pi()/size_lat_EBAF)) ))'; %Areas of latitudinal bandsncid_ERA5_1940_2023 = netcdf.open('./ERA5_Warming_1940_2023.nc');T_ERA5_1940_2023 = netcdf.getVar(ncid_ERA5_1940_2023,3);T_ERA5_1940_2023 = 0.0018123132910792558*double(T_ERA5_1940_2023) + 256.09430868710444;DeltaT_ERA5_2003_2023_minus_1940_1960 = mean(T_ERA5_1940_2023(:,:,757:1008),3) - mean(T_ERA5_1940_2023(:,:,1:252),3);T_ERA5_1940_1960 = mean(T_ERA5_1940_2023(:,:,1:252),3);T_ERA5_1940_1960_b = T_ERA5_1940_2023(:,:,1:252);DeltaT_ERA5_2003_2023_minus_1940_1960_prime(:,:) = imresize(DeltaT_ERA5_2003_2023_minus_1940_1960(:,:),[360 180],'bicubic');T_ERA5_1940_1960_prime(:,:) = imresize(T_ERA5_1940_1960(:,:),[360 180],'bicubic');for k = 1:252    T_ERA5_1940_1960_b_prime(:,:,k) = imresize(T_ERA5_1940_1960_b(:,:,k),[360 180],'bicubic');endfor i=1:size_lon_EBAF    i    for j = 1:size_lat_EBAF                DeltaT_ERA5_2003_2023_minus_1940_1960_1deg(i,j)=DeltaT_ERA5_2003_2023_minus_1940_1960_prime(i,181-j);        T_ERA5_1940_1960_1deg(i,j)= T_ERA5_1940_1960_prime(i,181-j);        for k=1:252            T_ERA5_1940_1960_b_1deg(i,j,k) = T_ERA5_1940_1960_b_prime(i,181-j,k);            T_ERA5_1940_1960_b_1deg_2K(i,j,k) = T_ERA5_1940_1960_b_prime(i,181-j,k) + DeltaT_2K_IPCC(i,j);            T_ERA5_1940_1960_b_1deg_4K(i,j,k) = T_ERA5_1940_1960_b_prime(i,181-j,k) + DeltaT_4K_IPCC(i,j);        end            endendGlobal_mean_warming_1940_1960_to_2003_2023 = sum(mean(DeltaT_ERA5_2003_2023_minus_1940_1960_1deg)' .* Area_EBAF_zonal)/sum(Area_EBAF_zonal);LGTC_ERA5_2003_2023_minus_1940_1960_1deg = DeltaT_ERA5_2003_2023_minus_1940_1960_1deg/Global_mean_warming_1940_1960_to_2003_2023;%T_blended_HadCRUT5 =  netcdf.getVar(ncid,0);%T_blended_HadCRUT5(T_blended_HadCRUT5 <= -1000) = NaN;%T_HadCRUT5_lat_means = mean(T_blended_HadCRUT5,'omitnan');%Annual_Zonal_means at 1 degree latitude from -87.5 to 87.5 degreesfor i=1:size_lat_EBAF    for k = 1:21 %22 whole years from 2001 to 2022 inclusive            Annual_Zonal_Ts_ERA5(i,k) = 0.0;            Annual_Zonal_Cloud_Amount_EBAF(i,k) = 0.0;            Annual_Zonal_Cloud_Incident_EBAF(i,k) = 0.0;            Annual_Zonal_SW_ClearSky_EBAF(i,k)=0.0;            Annual_Zonal_SW_AllSky_EBAF(i,k)=0.0;            Annual_Zonal_LW_ClearSky_EBAF(i,k)=0.0;            Annual_Zonal_LW_AllSky_EBAF(i,k)=0.0;            Annual_Zonal_S_in_EBAF(i,k)=0.0;            Annual_Zonal_sigmaT4_ERA5(i,k) = 0.0;            Annual_Zonal_T3_EBAF(i,k) = 0.0;            Annual_Zonal_alpha_Cloud_EBAF(i,k) = 0.0;    endendLoad_Data_EBMLoad_HadCRUT5_LGM[size_HadCRUT5_lon, size_HadCRUT5_lat, size_HadCRUT5_time] = size(T_blended_HadCRUT5);T_blended_monthly_latitudinal_means = mean(T_blended_HadCRUT5, 'omitnan');%replace locations with NaN with monthly zonal averagefor i=1:size_HadCRUT5_lon    for j = 1:size_HadCRUT5_lat        for k = 1:size_HadCRUT5_time            if (isnan(T_blended_HadCRUT5(i,j,k)) == 1)               T_blended_HadCRUT5(i,j,k) = T_blended_monthly_latitudinal_means(1,j,k);             end        end    endendT_blended_monthly_latitudinal_means2 = mean(T_blended_HadCRUT5, 'omitnan');%Using HadCRUT5 and CRUTEM to get absolute temperature record for 2001 to 2021%Need to replace NaNs with monthly zobal mean (so doesn't affect monthly zonal mean)?%Or could simnply omit NaNsfor k = 1:21            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+1) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+1) + CRUTEM_Jan' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+2) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+2) + CRUTEM_Feb' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+3) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+3) + CRUTEM_Mar' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+4) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+4) + CRUTEM_Apr' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+5) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+5) + CRUTEM_May' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+6) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+6) + CRUTEM_Jun' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+7) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+7) + CRUTEM_Jul' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+8) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+8) + CRUTEM_Aug' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+9) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+9) + CRUTEM_Sep' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+10) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+10) + CRUTEM_Oct' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+11) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+11) + CRUTEM_Nov' + 273.15;            Absolute_T_HadCRUT5_2001_2021(:,:,(k-1)*12+12) = T_blended_HadCRUT5(:,:,12*(2000-1849+k-1)+12) + CRUTEM_Dec' + 273.15;endfor i=1:size_lat_EBAF    for j = 1:size_lon_EBAF        for k = 1:21            for l=1:12                Annual_Zonal_Cloud_Amount_EBAF(i,k) = Annual_Zonal_Cloud_Amount_EBAF(i,k) + 0.01*Cloud_Amount_EBAF(j,i,k*12+l-12)/(size_lon_EBAF*12);                Annual_Zonal_SW_ClearSky_EBAF(i,k)= Annual_Zonal_SW_ClearSky_EBAF(i,k)+ S_out_ClearSky_EBAF(j,i,k*12+l-12)/(12*size_lon_EBAF) ;                Annual_Zonal_SW_AllSky_EBAF(i,k)= Annual_Zonal_SW_AllSky_EBAF(i,k) + S_out_AllSky_EBAF(j,i,k*12+l-12)/(12*size_lon_EBAF) ;                Annual_Zonal_LW_ClearSky_EBAF(i,k)= Annual_Zonal_LW_ClearSky_EBAF(i,k) + L_out_ClearSky_EBAF(j,i,k*12+l-12)/(12*size_lon_EBAF) ;                Annual_Zonal_LW_AllSky_EBAF(i,k)= Annual_Zonal_LW_AllSky_EBAF(i,k) + L_out_AllSky_EBAF(j,i,k*12+l-12)/(12*size_lon_EBAF) ;                Annual_Zonal_S_in_EBAF(i,k)= Annual_Zonal_S_in_EBAF(i,k) + S_in_EBAF(j,i,k*12+l-12)/(12*size_lon_EBAF) ;                            end        end    endend    %Extracted are 2001 to 2021 inclusivefor i=1:size_lat_EBAF    for j = 1:size_lon_EBAF        for k = 1:21            for l=1:12                                    Extracted_Cloud_Amount_EBAF(j,i,l+12*(k-1)) = 0.01*Cloud_Amount_EBAF(j,i,k*12+l-12);                    Extracted_SW_ClearSky_EBAF(j,i,l+12*(k-1)) = S_out_ClearSky_EBAF(j,i,k*12+l-12) ;                    Extracted_SW_AllSky_EBAF(j,i,l+12*(k-1)) = S_out_AllSky_EBAF(j,i,k*12+l-12) ;                    Extracted_LW_ClearSky_EBAF(j,i,l+12*(k-1)) = L_out_ClearSky_EBAF(j,i,k*12+l-12) ;                    Extracted_LW_AllSky_EBAF(j,i,l+12*(k-1)) =  L_out_AllSky_EBAF(j,i,k*12+l-12) ;                    Extracted_S_in_EBAF(j,i,l+12*(k-1)) =  S_in_EBAF(j,i,k*12+l-12) ;                            end        end    endend                                               for i=1:size_lat_EBAF    for j = 1:size_lon_EBAF        for k = 1:21            for l=1:12                Annual_Zonal_Ts_ERA5(i,k) = Annual_Zonal_Ts_ERA5(i,k) + T_ERA5(j,i,(k-1)*12+l)/(size_lon_EBAF*12);                Annual_Zonal_sigmaT4_ERA5(i,k) = Annual_Zonal_sigmaT4_ERA5(i,k) + (5.67e-8 * T_ERA5(j,i,(k-1)*12+l)*T_ERA5(j,i,(k-1)*12+l)*T_ERA5(j,i,(k-1)*12+l)*T_ERA5(j,i,(k-1)*12+l))/(12*size_lon_EBAF);                Annual_Zonal_sigmaT3_ERA5(i,k) = Annual_Zonal_sigmaT4_ERA5(i,k) + (5.67e-8 * T_ERA5(j,i,(k-1)*12+l)*T_ERA5(j,i,(k-1)*12+l)*T_ERA5(j,i,(k-1)*12+l))/(12*size_lon_EBAF);            end        end    endend                                               k=1;for i=1:size_lon_EBAF    for j=1:size_lat_EBAF                            T_ERA5_list(k)= single(mean(T_ERA5(i,j,:),3));            Total_outgoing_list(k)= single(mean( Extracted_LW_AllSky_EBAF(i,j,:) + Extracted_SW_AllSky_EBAF(i,j,:) , 3));                        ClearSky_LW_outgoing_list(k)= single(mean( Extracted_LW_ClearSky_EBAF(i,j,:),3));            ClearSky_SW_outgoing_list(k)= single(mean( Extracted_SW_ClearSky_EBAF(i,j,:),3));                                                           Epsilon_list(k) = single(mean (Extracted_LW_ClearSky_EBAF(i,j,:),3)./mean((5.67e-8*T_ERA5(i,j,:).^4),3) );            Albedo_list(k) = single(mean (Extracted_SW_ClearSky_EBAF(i,j,:),3)./mean(S_in_EBAF(i,j,:),3) );                    k=k+1;                                                endend                                               modelfunction_1stOrder=@(b,x) b(1) + b(2)*x;                                                         Coefficients_linear_T_LoutplusSout = polyfit(T_ERA5_list, Total_outgoing_list,1);Coefficients_linear_T_epsilon = polyfit(T_ERA5_list, Epsilon_list,1);Coefficients_linear_T_Lout_ClearSky = polyfit(T_ERA5_list, ClearSky_LW_outgoing_list,1);Coefficients_linear_T_Sout_ClearSky = polyfit(T_ERA5_list, ClearSky_SW_outgoing_list,1);Coefficients_linear_T_alpha = polyfit(T_ERA5_list, Albedo_list,1);                                               figure(801)subplot(3,1,1)plot(T_ERA5_list,Total_outgoing_list, T_ERA5_list, polyval(Coefficients_linear_T_LoutplusSout, T_ERA5_list,1))subplot(3,2,3)plot(T_ERA5_list,ClearSky_LW_outgoing_list,T_ERA5_list,polyval(Coefficients_linear_T_Lout_ClearSky, T_ERA5_list,1) );subplot(3,2,5)plot(T_ERA5_list,Epsilon_list,T_ERA5_list,polyval(Coefficients_linear_T_epsilon, T_ERA5_list,1) );subplot(3,2,4)plot(T_ERA5_list,ClearSky_SW_outgoing_list,T_ERA5_list,polyval(Coefficients_linear_T_Sout_ClearSky, T_ERA5_list,1) );subplot(3,2,6)plot(T_ERA5_list,Albedo_list,T_ERA5_list,polyval(Coefficients_linear_T_alpha, T_ERA5_list,1) );    %clear('T_ERA5_list');%clear('Epsilon_list');%clear('Total_outgoing_list');%clear('Albedo_list');%clear('ClearSky_LW_outgoing_list');%clear('ClearSky_SW_outgoing_list');                                                                           Climatological_mean_S_in = mean(S_in_EBAF(:,:,1:252));Climatological_mean_S_in = permute(Climatological_mean_S_in,[3,2,1]);Climatological_mean_S_in = mean(Climatological_mean_S_in);for i=1:size_lat_EBAF    for j = 1:size_lon_EBAF        for k = 1:21            for l=1:12                Annual_Zonal_Cloud_Incident_EBAF(i,k) = Annual_Zonal_Cloud_Incident_EBAF(i,k) + S_in_EBAF(j,i,k*12+l-12)*0.01*Cloud_Amount_EBAF(j,i,k*12+l-12)/(12*size_lon_EBAF*Climatological_mean_S_in(i));                    end        end    endendAnnual_Zonal_epsilon_AllSky_EBAF = Annual_Zonal_LW_AllSky_EBAF./Annual_Zonal_sigmaT4_ERA5;Annual_Zonal_epsilon_ClearSky_EBAF = Annual_Zonal_LW_ClearSky_EBAF./Annual_Zonal_sigmaT4_ERA5;Annual_Zonal_epsilon_CloudySky_EBAF = (Annual_Zonal_epsilon_AllSky_EBAF - (1-Annual_Zonal_Cloud_Amount_EBAF).*Annual_Zonal_epsilon_ClearSky_EBAF)./(Annual_Zonal_Cloud_Amount_EBAF);Annual_Zonal_c_epsilon_EBAF = (1-Annual_Zonal_epsilon_CloudySky_EBAF)./(1-Annual_Zonal_epsilon_ClearSky_EBAF);Annual_Zonal_alpha_AllSky_EBAF = Annual_Zonal_SW_AllSky_EBAF./Annual_Zonal_S_in_EBAF;Annual_Zonal_alpha_ClearSky_EBAF = Annual_Zonal_SW_ClearSky_EBAF./Annual_Zonal_S_in_EBAF;Annual_Zonal_alpha_CloudySky_EBAF = (Annual_Zonal_alpha_AllSky_EBAF - (1-Annual_Zonal_Cloud_Incident_EBAF).*Annual_Zonal_alpha_ClearSky_EBAF)./(Annual_Zonal_Cloud_Incident_EBAF);                                              %plot spatial alpha and epsilon:Spatial_epsilon_AllSky_EBAF = Extracted_LW_AllSky_EBAF./(5.67e-8*T_ERA5.^4);Spatial_epsilon_ClearSky_EBAF = Extracted_LW_ClearSky_EBAF./(5.67e-8*T_ERA5.^4);Spatial_epsilon_AllSky_EBAF_ERA5 = Extracted_LW_AllSky_EBAF./(5.67e-8*T_ERA5.^4);Spatial_epsilon_ClearSky_EBAF_ERA5 = Extracted_LW_ClearSky_EBAF./(5.67e-8*T_ERA5.^4);Spatial_alpha_AllSky_EBAF = Extracted_SW_AllSky_EBAF./Extracted_S_in_EBAF;Spatial_alpha_ClearSky_EBAF = Extracted_SW_ClearSky_EBAF./Extracted_S_in_EBAF;%Climatological by averaging over time before divisionSpatial_climatological_alpha_ClearSky_EBAF = mean(Extracted_SW_ClearSky_EBAF,3)./mean(Extracted_S_in_EBAF,3);Spatial_climatological_alpha_AllSky_EBAF = mean(Extracted_SW_AllSky_EBAF,3)./mean(Extracted_S_in_EBAF,3);%Analysis for lambda_albedoSpatial_climatological_T_ERA5 = mean(T_ERA5,3);Coefficients_and_statistical_analysis_data = zeros([12 40]);                                                       for i3=1:45     k_land=0;     k_ocean=0;     beta_ClearSky = 0.25+0.01*i3;     attempt = 0.35;     for i=1:size_lon_EBAF         for j= 1:size_lat_EBAF             if(Land_Mask(i,j) > 0.5 )% & Spatial_climatological_T_ERA5(i,j) < 290.0) %clause to remove hot and low-albedo deserts                 k_land = k_land+1;                 Land_alpha_climatological_ClearSky(k_land ) = Spatial_climatological_alpha_ClearSky_EBAF(i,j);                 Land_RH_climatological(k_land ) = mean(RH_ERA5(i,j),3);                 Land_T_ERA5_climatological(k_land ) = Spatial_climatological_T_ERA5(i,j);                 Land_latitude(k_land ) = rad2deg(phi_rad_EBAF(1,j));                 Land_weights(k_land) =  Area_EBAF_zonal(j)/360.0;                                                                           attempt = 0.35;                 for k=1:100                       alpha_ClearSky_planetary_infer_attempt = attempt * (1 + beta_ClearSky*(1-attempt)*0.5*(3*sin(deg2rad(Land_latitude(k_land)))*sin(deg2rad(Land_latitude(k_land))) - 1.0));                       attempt = attempt + (Land_alpha_climatological_ClearSky(k_land ) -alpha_ClearSky_planetary_infer_attempt)/2.0;                 end                 Land_alpha_planetary_mean(k_land) = attempt;                                                                           end            if(Land_Mask(i,j) <0.5  ) %- to remove outliers in ocean: & ~(Spatial_climatological_alpha_ClearSky_EBAF(i,j) < 0.5 &  Spatial_climatological_T_ERA5(i,j) < 268.0))            k_ocean = k_ocean+1;            Ocean_alpha_climatological_ClearSky(k_ocean) = Spatial_climatological_alpha_ClearSky_EBAF(i,j);            Ocean_RH_climatological(k_ocean) = mean(RH_ERA5(i,j),3);            Ocean_T_ERA5_climatological(k_ocean) = Spatial_climatological_T_ERA5(i,j);            Ocean_latitude(k_ocean) = rad2deg(phi_rad_EBAF(1,j));            Ocean_weights(k_ocean) =  Area_EBAF_zonal(j)/360.0;            attempt = 0.35;            for k=1:100                alpha_ClearSky_planetary_infer_attempt = attempt * (1 + beta_ClearSky*(1-attempt)*0.5*(3*sin(deg2rad(Ocean_latitude(k_ocean)))*sin(deg2rad(Ocean_latitude(k_ocean))) - 1.0));                attempt = attempt + (Ocean_alpha_climatological_ClearSky(k_ocean ) -alpha_ClearSky_planetary_infer_attempt)/2.0;            end            Ocean_alpha_planetary_mean(k_ocean) = attempt;                                                                       end    end                                                                                                               end modelfunction_erf_alphabar_T=@(b,x)  (b(1) + b(2))/2.0 - ((b(1) - b(2)))/2.0*erf( (x - (b(3) + b(4))/2.0)/((b(4) - b(3))/2.0) ) ;                                                    beta_ClearSky Land_alpha_T_nlm = fitnlm(Land_T_ERA5_climatological', Land_alpha_planetary_mean', modelfunction_erf_alphabar_T, [0.6 0.12 240 273] ) Land_alpha_mean_warm = Land_alpha_T_nlm.Coefficients.Estimate(2) Land_alpha_mean_cold = Land_alpha_T_nlm.Coefficients.Estimate(1) Land_T_cold = Land_alpha_T_nlm.Coefficients.Estimate(3) Land_T_warm = Land_alpha_T_nlm.Coefficients.Estimate(4)                                                    modelfunction_erf_alphabar_T_Ocean=@(b,x)  (Land_alpha_mean_cold + b(1))/2.0 - ((Land_alpha_mean_cold - b(1)))/2.0*erf( (x - (b(2) + b(3))/2.0)/((b(3) - b(2))/2.0) ) ; Ocean_alpha_T_nlm = fitnlm(Ocean_T_ERA5_climatological', Ocean_alpha_planetary_mean', modelfunction_erf_alphabar_T_Ocean, [0.12 240 273] )                                                        Ocean_alpha_mean_cold = Land_alpha_T_nlm.Coefficients.Estimate(1) Ocean_alpha_mean_warm = Ocean_alpha_T_nlm.Coefficients.Estimate(1) Ocean_T_cold = Ocean_alpha_T_nlm.Coefficients.Estimate(2) Ocean_T_warm = Ocean_alpha_T_nlm.Coefficients.Estimate(3)                                                        Coefficients_and_statistical_analysis_data(:,i3) = [beta_ClearSky; sqrt(Ocean_alpha_T_nlm.MSE); sqrt(Land_alpha_T_nlm.MSE); sqrt(Ocean_alpha_T_nlm.MSE) + sqrt(Land_alpha_T_nlm.MSE);  Land_alpha_mean_cold; Land_alpha_mean_warm; Land_T_cold; Land_T_warm; Ocean_alpha_mean_cold ; Ocean_alpha_mean_warm ; Ocean_T_cold ; Ocean_T_warm ];                                                       end[~, min_id] = min(Coefficients_and_statistical_analysis_data(4,:));beta_ClearSky = Coefficients_and_statistical_analysis_data(1,min_id)%Redo with best for beta_ClearSkyk_land=0;k_ocean=0;                                                      attempt = 0.35;for i=1:size_lon_EBAF     for j= 1:size_lat_EBAF          if(Land_Mask(i,j) > 0.5 )% & Spatial_climatological_T_ERA5(i,j) < 290.0) %clause to remove hot and low-albedo deserts                k_land = k_land+1;                Land_alpha_climatological_ClearSky(k_land ) = Spatial_climatological_alpha_ClearSky_EBAF(i,j);                Land_RH_climatological(k_land ) = mean(RH_ERA5(i,j),3);                Land_T_ERA5_climatological(k_land ) = Spatial_climatological_T_ERA5(i,j);                Land_latitude(k_land ) = rad2deg(phi_rad_EBAF(1,j));                                                                                                                                         attempt = 0.35;                for k=1:100                     alpha_ClearSky_planetary_infer_attempt = attempt * (1 + beta_ClearSky*(1-attempt)*0.5*(3*sin(deg2rad(Land_latitude(k_land)))*sin(deg2rad(Land_latitude(k_land))) - 1.0));                     attempt = attempt + (Land_alpha_climatological_ClearSky(k_land ) -alpha_ClearSky_planetary_infer_attempt)/2.0;                end                Land_alpha_planetary_mean(k_land) = attempt;                Spatial_climatological_alpha_planetary_mean(i,j) =attempt;           end           if(Land_Mask(i,j) <0.5 ) %- to remove outliers in ocean: & ~(Spatial_climatological_alpha_ClearSky_EBAF(i,j) < 0.5 &  Spatial_climatological_T_ERA5(i,j) < 268.0))                   k_ocean = k_ocean+1;                    Ocean_alpha_climatological_ClearSky(k_ocean) = Spatial_climatological_alpha_ClearSky_EBAF(i,j);                    Ocean_RH_climatological(k_ocean) = mean(RH_ERA5(i,j),3);                    Ocean_T_ERA5_climatological(k_ocean) = Spatial_climatological_T_ERA5(i,j);                    Ocean_latitude(k_ocean) = rad2deg(phi_rad_EBAF(1,j));                    attempt = 0.35;                    for k=1:100                        alpha_ClearSky_planetary_infer_attempt = attempt * (1 + beta_ClearSky*(1-attempt)*0.5*(3*sin(deg2rad(Ocean_latitude(k_ocean)))*sin(deg2rad(Ocean_latitude(k_ocean))) - 1.0));                        attempt = attempt + (Ocean_alpha_climatological_ClearSky(k_ocean ) -alpha_ClearSky_planetary_infer_attempt)/2.0;                    end                Ocean_alpha_planetary_mean(k_ocean) = attempt;                Spatial_climatological_alpha_planetary_mean(i,j) =attempt;           end     end                                                                                                              endmodelfunction_erf_alphabar_T=@(b,x)  (b(1) + b(2))/2.0 - ((b(1) - b(2)))/2.0*erf( (x - (b(3) + b(4))/2.0)/((b(4) - b(3))/2.0) ) ;                                                   beta_ClearSkyLand_alpha_T_nlm = fitnlm(Land_T_ERA5_climatological', Land_alpha_planetary_mean', modelfunction_erf_alphabar_T, [0.6 0.12 240 273])Land_alpha_mean_warm = Land_alpha_T_nlm.Coefficients.Estimate(2)Land_alpha_mean_cold = Land_alpha_T_nlm.Coefficients.Estimate(1)Land_T_cold = Land_alpha_T_nlm.Coefficients.Estimate(3)Land_T_warm = Land_alpha_T_nlm.Coefficients.Estimate(4)                                                   modelfunction_erf_alphabar_T_Ocean=@(b,x)  (Land_alpha_mean_cold + b(1))/2.0 - ((Land_alpha_mean_cold - b(1)))/2.0*erf( (x - (b(2) + b(3))/2.0)/((b(3) - b(2))/2.0) ) ;Ocean_alpha_T_nlm = fitnlm(Ocean_T_ERA5_climatological', Ocean_alpha_planetary_mean', modelfunction_erf_alphabar_T_Ocean, [0.12 240 273])                                                       Ocean_alpha_mean_cold = Land_alpha_T_nlm.Coefficients.Estimate(1)Ocean_alpha_mean_warm = Ocean_alpha_T_nlm.Coefficients.Estimate(1)Ocean_T_cold = Ocean_alpha_T_nlm.Coefficients.Estimate(2)Ocean_T_warm = Ocean_alpha_T_nlm.Coefficients.Estimate(3)Fraction_error_dalpha_dT = max([sqrt(Ocean_alpha_T_nlm.MSE)  sqrt(Land_alpha_T_nlm.MSE)])/(Ocean_alpha_mean_cold - Ocean_alpha_mean_warm);for k=1:21    %Alpha cloud from Planetary mean cloudiness, diffuse approximation    clear attempt;    attempt = 0.5;    k    for j=1:100 %n-step iteration        alpha_Cloud_planetary_attempt_ifda_EBAF = attempt + (sum(Area_EBAF_zonal.*Annual_Zonal_alpha_ClearSky_EBAF(:,k))/sum(Area_EBAF_zonal) * (1.0 - attempt) * (1 - attempt))/(1.0 - sum(Area_EBAF_zonal.*Annual_Zonal_alpha_ClearSky_EBAF(:,k))/sum(Area_EBAF_zonal) * attempt ) ;        attempt = attempt + ( (sum(Annual_Zonal_alpha_CloudySky_EBAF(:,k).*Area_EBAF_zonal)/sum(Area_EBAF_zonal)) - alpha_Cloud_planetary_attempt_ifda_EBAF)/2.0;    end    Annual_alpha_Cloud_planetary_mean_ifda_EBAF(k) = attempt;endfor k=1:21    Annual_alpha_ClearSky_planetary_infer_EBAF(:,k) = linspace(0,0,size_array_EBAF);    k    clear attempt;    %find inferred planetary surface albedo for that local surface albedo    attempt = sum(Annual_Zonal_alpha_ClearSky_EBAF(:,k).*Area_EBAF_zonal)/sum(Area_EBAF_zonal);    %beta_ClearSky = 0.4;    for i=1:size_array_EBAF        for j=1:100            alpha_ClearSky_planetary_infer_attempt = attempt * (1 + beta_ClearSky*(1-attempt)*0.5*(3*sin(phi_rad_EBAF(i))*sin(phi_rad_EBAF(i)) - 1.0));            attempt = attempt + (Annual_Zonal_alpha_ClearSky_EBAF(i,k) -alpha_ClearSky_planetary_infer_attempt)/2.0;        end        Annual_alpha_ClearSky_planetary_infer_EBAF(i,k) = attempt;        attempt;        attempt =sum(Annual_Zonal_alpha_ClearSky_EBAF(:,k).*Area_EBAF_zonal)/sum(Area_EBAF_zonal);    endendfor k=1:21    %Local alpha cloud     attempt=0.5;    for i=1:size_array_EBAF        for j=1:100 %n-step iteration            alpha_cloud_attempt = attempt + (Annual_alpha_ClearSky_planetary_infer_EBAF(i,k)* (1.0 - attempt) * (1.0 -Annual_alpha_Cloud_planetary_mean_ifda_EBAF(k))) /(1.0 - Annual_alpha_ClearSky_planetary_infer_EBAF(i,k) * Annual_alpha_Cloud_planetary_mean_ifda_EBAF(k)) ;            attempt = attempt + (Annual_Zonal_alpha_CloudySky_EBAF(i,k) - alpha_cloud_attempt)/2.0;        end        Annual_alpha_Cloud_EBAF_FromMean_ifda(i,k) = attempt;        attempt = 0.5;    endendfigure(504)subplot(2,1,1)plot(sum(Area_EBAF_zonal.*Annual_Zonal_Ts_ERA5)/sum(Area_EBAF_zonal),sum(Area_EBAF_zonal.*Annual_alpha_Cloud_EBAF_FromMean_ifda)/sum(Area_EBAF_zonal) )subplot(2,1,2)plot(sum(Area_EBAF_zonal.*Annual_Zonal_Ts_ERA5)/sum(Area_EBAF_zonal),sum(Area_EBAF_zonal.*Annual_Zonal_c_epsilon_EBAF)/sum(Area_EBAF_zonal) )alpha_Cloud_EBAF_fit = fit( (sum(Area_EBAF_zonal.*Annual_Zonal_Ts_ERA5)/sum(Area_EBAF_zonal))', (sum(Area_EBAF_zonal.*Annual_alpha_Cloud_EBAF_FromMean_ifda)/sum(Area_EBAF_zonal) )', 'poly1')alpha_Cloud_EBAF_fit_mean = mean(sum(Area_EBAF_zonal.*Annual_alpha_Cloud_EBAF_FromMean_ifda)/sum(Area_EBAF_zonal))alpha_Cloud_EBAF_fit_std = std(sum(Area_EBAF_zonal.*Annual_alpha_Cloud_EBAF_FromMean_ifda)/sum(Area_EBAF_zonal))c_ep_EBAF_HadCRUT5_CRUTEM_fit = fit( (sum(Area_EBAF_zonal.*Annual_Zonal_Ts_ERA5)/sum(Area_EBAF_zonal))', (sum(Area_EBAF_zonal.*Annual_Zonal_c_epsilon_EBAF)/sum(Area_EBAF_zonal))', 'poly1')c_ep_EBAF_HadCRUT5_CRUTEM_fit_mean = mean(sum(Area_EBAF_zonal.*Annual_Zonal_c_epsilon_EBAF)/sum(Area_EBAF_zonal))c_ep_EBAF_HadCRUT5_CRUTEM_fit_std = std(sum(Area_EBAF_zonal.*Annual_Zonal_c_epsilon_EBAF)/sum(Area_EBAF_zonal))lonHadCRUT = linspace(-177.5, 177.5, 72);latHadCRUT = linspace(-87.5, 87.5, 36);for i=1:size_lon_EBAF    for j=1:size_lat_EBAF        for k=1:252            if (Spatial_alpha_AllSky_EBAF(i,j,k) > 1.0)                Spatial_alpha_AllSky_EBAF(i,j,k) = nan;            end            if (Spatial_alpha_ClearSky_EBAF(i,j,k) > 1.0)                Spatial_alpha_ClearSky_EBAF(i,j,k) = nan;            end        end    endendfor i=1:size_lon_EBAF     for j = 1:size_lat_EBAF          for k = 1:252                                                                          Spatial_epsilon_CloudySky_EBAF(i,j,k) = (Spatial_epsilon_AllSky_EBAF(i,j,k) - (1-Extracted_Cloud_Amount_EBAF(i,j,k)).*Spatial_epsilon_ClearSky_EBAF(i,j,k))./(Extracted_Cloud_Amount_EBAF(i,j,k));                                                                                                                                          if(Spatial_epsilon_CloudySky_EBAF(i,j,k) < Spatial_epsilon_AllSky_EBAF(i,j,k))                     Spatial_epsilon_CloudySky_EBAF(i,j,k) = Spatial_epsilon_AllSky_EBAF(i,j,k);                end                if(Spatial_epsilon_ClearSky_EBAF(i,j,k) < 1.0 )                    Spatial_c_epsilon_EBAF(i,j,k) = (1.00-Spatial_epsilon_CloudySky_EBAF(i,j,k))/(1.00-Spatial_epsilon_ClearSky_EBAF(i,j,k));                end                if(Spatial_epsilon_ClearSky_EBAF(i,j,k) > 1.0 | isnan(Spatial_c_epsilon_EBAF(i,j,k)) | isinf(Spatial_c_epsilon_EBAF(i,j,k) ))                     Spatial_c_epsilon_EBAF(i,j,k) = 1.0;                end           end     endend                                               Spatial_alpha_CloudySky_EBAF = (Spatial_alpha_AllSky_EBAF - (1-Extracted_Cloud_Amount_EBAF).*Spatial_alpha_ClearSky_EBAF)./(Extracted_Cloud_Amount_EBAF);for i = 1:size_lon_EBAF    i    for k=1:252        Spatial_alpha_ClearSky_planetary_infer_EBAF(i,:,k) = linspace(0,0,size_array_EBAF);        clear attempt;        %find inferred planetary surface albedo for that local surface albedo        %in that month                for l=1:size_lat_EBAF            attempt = sum(Annual_Zonal_alpha_ClearSky_EBAF(:,21).*Area_EBAF_zonal)/sum(Area_EBAF_zonal);            %beta_ClearSky = 0.4; %Should do this after the section where beta_ClearSky is optimised - inserted optimised value used here            for j=1:100                alpha_ClearSky_planetary_infer_attempt = attempt * (1 + beta_ClearSky*(1-attempt)*0.5*(3*sin(phi_rad_EBAF(l))*sin(phi_rad_EBAF(l)) - 1.0));                attempt = attempt + (Spatial_alpha_ClearSky_EBAF(i,l,k) - alpha_ClearSky_planetary_infer_attempt)/2.0;            end            Spatial_alpha_ClearSky_planetary_infer_EBAF(i,l,k) = attempt;            attempt =sum(Annual_Zonal_alpha_ClearSky_EBAF(:,21).*Area_EBAF_zonal)/sum(Area_EBAF_zonal);        end    endendfor k=1:252    k    %Local alpha cloud    attempt=0.5;    for j=1:size_lon_EBAF        for i=1:size_lat_EBAF            for l=1:100 %n-step iteration                alpha_cloud_attempt = attempt + (Spatial_alpha_ClearSky_planetary_infer_EBAF(j,i,k)* (1.0 - attempt) * (1.0 -mean(Annual_alpha_Cloud_planetary_mean_ifda_EBAF))) /(1.0 - Spatial_alpha_ClearSky_planetary_infer_EBAF(j,i,k) * mean(Annual_alpha_Cloud_planetary_mean_ifda_EBAF)) ;                attempt = attempt + (Spatial_alpha_CloudySky_EBAF(j,i,k) - alpha_cloud_attempt)/2.0;            end            Spatial_alpha_Cloud_EBAF_FromMean_ifda(j,i,k) = attempt;            if (attempt > 1.0 )                Spatial_alpha_Cloud_EBAF_FromMean_ifda(j,i,k) = NaN;            end            if (attempt < 0.0 )                Spatial_alpha_Cloud_EBAF_FromMean_ifda(j,i,k) = NaN;            end            attempt = 0.5;        end    endendSpatial_alpha_ClearSky_EBAF2 = [Spatial_alpha_ClearSky_EBAF(:,:,:); Spatial_alpha_ClearSky_EBAF(1,:,:)];load 'coastlines'figure(701)subplot(4,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_ClearSky_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,3)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_ClearSky_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,5)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_ClearSky_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,7)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_ClearSky_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;Spatial_alpha_AllSky_EBAF2 = [Spatial_alpha_AllSky_EBAF(:,:,:); Spatial_alpha_AllSky_EBAF(1,:,:)];subplot(4,2,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_AllSky_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,4)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_AllSky_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,6)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_AllSky_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,8)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_AllSky_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;Spatial_epsilon_ClearSky_EBAF2 = [Spatial_epsilon_ClearSky_EBAF(:,:,:); Spatial_epsilon_ClearSky_EBAF(1,:,:)];figure(702)subplot(4,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_epsilon_ClearSky_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.3 1]);hold off;subplot(4,2,3)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_epsilon_ClearSky_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.3 1]);hold off;subplot(4,2,5)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_epsilon_ClearSky_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.3 1]);hold off;subplot(4,2,7)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_epsilon_ClearSky_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.3 1]);hold off;Spatial_epsilon_AllSky_EBAF2 = [Spatial_epsilon_AllSky_EBAF(:,:,:); Spatial_epsilon_AllSky_EBAF(1,:,:)];subplot(4,2,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_epsilon_AllSky_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.3 1]);hold off;subplot(4,2,4)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_epsilon_AllSky_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.3 1]);hold off;subplot(4,2,6)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_epsilon_AllSky_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.3 1]);hold off;subplot(4,2,8)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_epsilon_AllSky_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.3 1]);hold off;Extracted_SW_ClearSky_EBAF2 = [Extracted_SW_ClearSky_EBAF(:,:,:); Extracted_SW_ClearSky_EBAF(1,:,:)];figure(301)subplot(4,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_SW_ClearSky_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 200]);hold off;        subplot(4,2,3)        hold on;        worldmap ('world')        mlabel("off")        %plabel("off")        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_SW_ClearSky_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')        plotm(coastlat,coastlon,'k','linewidth',1)        clim([0 200]);        hold off;        subplot(4,2,5)        hold on;        worldmap ('world')        mlabel("off")        %plabel("off")        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_SW_ClearSky_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')        plotm(coastlat,coastlon,'k','linewidth',1)        clim([0 200]);        hold off;        subplot(4,2,7)        hold on;        worldmap ('world')        mlabel("off")        %plabel("off")        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_SW_ClearSky_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')        plotm(coastlat,coastlon,'k','linewidth',1)        clim([0 200]);        hold off;        Extracted_SW_AllSky_EBAF2 = [Extracted_SW_AllSky_EBAF(:,:,:); Extracted_SW_AllSky_EBAF(1,:,:)];        subplot(4,2,2)        hold on;        worldmap ('world')        mlabel("off")        %plabel("off")        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_SW_AllSky_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')        plotm(coastlat,coastlon,'k','linewidth',1)        %clim([0 1]);        hold off;        subplot(4,2,4)        hold on;        worldmap ('world')        mlabel("off")        %plabel("off")        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_SW_AllSky_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')        plotm(coastlat,coastlon,'k','linewidth',1)        clim([0 200]);        hold off;        subplot(4,2,6)        hold on;        worldmap ('world')        mlabel("off")        %plabel("off")        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_SW_AllSky_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')        plotm(coastlat,coastlon,'k','linewidth',1)        clim([0 200]);        hold off;        subplot(4,2,8)        hold on;        worldmap ('world')        mlabel("off")        %plabel("off")        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_SW_AllSky_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')        plotm(coastlat,coastlon,'k','linewidth',1)        clim([0 200]);hold off;Extracted_LW_ClearSky_EBAF2 = [Extracted_LW_ClearSky_EBAF(1,:,:); Extracted_LW_ClearSky_EBAF(1,:,:)];            figure(302)        subplot(4,2,1)        hold on;        worldmap ('world')        mlabel("off")        %plabel("off")        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_LW_ClearSky_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')        plotm(coastlat,coastlon,'k','linewidth',1)        clim([0 350]);        hold off;                        subplot(4,2,3)                        hold on;                        worldmap ('world')                        mlabel("off")                        %plabel("off")                        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_LW_ClearSky_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')                        plotm(coastlat,coastlon,'k','linewidth',1)                        clim([0 350]);                        hold off;                        subplot(4,2,5)                        hold on;                        worldmap ('world')                        mlabel("off")                        %plabel("off")                        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_LW_ClearSky_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')                        plotm(coastlat,coastlon,'k','linewidth',1)                        clim([0 350]);                        hold off;                        subplot(4,2,7)                        hold on;                        worldmap ('world')                        mlabel("off")                        %plabel("off")                        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_LW_ClearSky_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')                        plotm(coastlat,coastlon,'k','linewidth',1)                        clim([0 350]);                        hold off;                        Extracted_LW_AllSky_EBAF2 =[Extracted_LW_AllSky_EBAF(:,:,:); Extracted_LW_AllSky_EBAF(1,:,:)];                        subplot(4,2,2)                        hold on;                        worldmap ('world')                        mlabel("off")                        %plabel("off")                        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_LW_AllSky_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')                        plotm(coastlat,coastlon,'k','linewidth',1)                        clim([0 350]);                        hold off;                        subplot(4,2,4)                        hold on;                        worldmap ('world')                        mlabel("off")                        %plabel("off")                        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_LW_AllSky_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')                        plotm(coastlat,coastlon,'k','linewidth',1)                        clim([0 350]);                        hold off;                        subplot(4,2,6)                        hold on;                        worldmap ('world')                        mlabel("off")                        %plabel("off")                        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_LW_AllSky_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')                        plotm(coastlat,coastlon,'k','linewidth',1)                        clim([0 350]);                        hold off;                        subplot(4,2,8)                        hold on;                        worldmap ('world')                        mlabel("off")                        %plabel("off")                        pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_LW_AllSky_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')                        plotm(coastlat,coastlon,'k','linewidth',1)                        clim([0 350]);                        hold off;                             Extracted_Cloud_Amount_EBAF2 =[Extracted_Cloud_Amount_EBAF(:,:,:); Extracted_Cloud_Amount_EBAF(1,:,:)];figure(303)subplot(4,2,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_Cloud_Amount_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,4)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_Cloud_Amount_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,6)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_Cloud_Amount_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,8)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_Cloud_Amount_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;Extracted_S_in_EBAF2 = [Extracted_S_in_EBAF(:,:,:); Extracted_S_in_EBAF(1,:,:)];subplot(4,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_S_in_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 550]);hold off;subplot(4,2,3)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_S_in_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 550]);hold off;subplot(4,2,5)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_S_in_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 550]);hold off;subplot(4,2,7)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Extracted_S_in_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 550]);hold off;       Spatial_c_epsilon_EBAF2 = [Spatial_c_epsilon_EBAF(:,:,:); Spatial_c_epsilon_EBAF(1,:,:)];figure(703)subplot(4,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_c_epsilon_EBAF2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 2]);hold off;subplot(4,2,3)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_c_epsilon_EBAF2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 2]);hold off;subplot(4,2,5)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_c_epsilon_EBAF2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 2]);hold off;subplot(4,2,7)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_c_epsilon_EBAF2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 2]);hold off;Spatial_alpha_Cloud_EBAF_FromMean_ifda2 = [Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,:); Spatial_alpha_Cloud_EBAF_FromMean_ifda(1,:,:)];subplot(4,2,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,4)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,6)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;subplot(4,2,8)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;figure(704)plot(rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(1,241, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(2,242, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(3,243, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(4,244, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(5,245, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(6,246, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(7,247, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(8,248, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(9,249, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(10,250, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(11,251, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(:,:,[linspace(12,252, 21)] ),3, 'omitnan'),'omitnan' )')figure(705)plot(rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(1,241, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(2,242, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(3,243, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(4,244, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(5,245, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(6,246, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(7,247, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(8,248, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(9,249, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(10,250, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(11,251, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_alpha_ClearSky_EBAF(:,:,[linspace(12,252, 21)] ),3, 'omitnan'),'omitnan' )')figure(706)plot(rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(1,241, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(2,242, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(3,243, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(4,244, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(5,245, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(6,246, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(7,247, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(8,248, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(9,249, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(10,250, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(11,251, 21)] ),3, 'omitnan'),'omitnan' )', ...     rad2deg(phi_rad_EBAF), mean(mean(Spatial_epsilon_ClearSky_EBAF(:,:,[linspace(12,252, 21)] ),3, 'omitnan'),'omitnan' )')%split into land and sea, get apprppriate dataland_counter=0;sea_counter=0;for i=1:size_lat_EBAF    for j = 1:size_lon_EBAF        for k = 1:252            if(Land_Mask(j,i) > 0.5 & ~isnan(Spatial_alpha_ClearSky_EBAF(j,i,k))==1) %Land                land_counter = land_counter + 1;                land_alpha_ClearSky(land_counter) = Spatial_alpha_ClearSky_EBAF(j,i,k);                land_T(land_counter) = T_ERA5(j,i,k);            end            if(Land_Mask(j,i) < 0.5) & ~isnan(Spatial_alpha_ClearSky_EBAF(j,i,k)==1)  %ocean                sea_counter = sea_counter + 1;                sea_alpha_ClearSky(sea_counter) = Spatial_alpha_ClearSky_EBAF(j,i,k);                sea_T(sea_counter) = T_ERA5(j,i,k);            end        end    endend     Tropopause_height_zonal_monthly_mean_pag_1deg;   %extract RH data%for i=1:size_lat_EBAF%    for j=1:size_lon_EBAF%        for k = 1:12%            if(j<=36)%                Extracted_RH_1991_2020_ECMWF(j,i,k) = RH_1991_2002(731-20*i, 711+20*j, k);%            end%            if(j>36)%                Extracted_RH_1991_2020_ECMWF(j,i,k) = RH_1991_2002(731-20*i, -9+20*(j-36), k);%            end%        end%    end%endcounter = 0;epsilon_ClearSky_climatological = zeros([size_lon_EBAF size_lat_EBAF 12]);predictors_epsilon_ClearSky_climatological = zeros([6 size_lon_EBAF size_lat_EBAF 12]);%get monthly climatological means for predictors and epsilonfor i=1:size_lat_EBAF     i    for j = 1:size_lon_EBAF        for k=1:252            %if(Spatial_epsilon_ClearSky_EBAF(j,i,k) < 2.0 & Spatial_epsilon_ClearSky_EBAF(j,i,k) > 0.2)                if(mod(k,12) == 0)                    epsilon_ClearSky_climatological(j,i,12) = epsilon_ClearSky_climatological(j,i,12) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,12) = predictors_epsilon_ClearSky_climatological(:,j,i,12) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Dec_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 1)                    epsilon_ClearSky_climatological(j,i,1) = epsilon_ClearSky_climatological(j,i,1) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,1) = predictors_epsilon_ClearSky_climatological(:,j,i,1) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Jan_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 2)                    epsilon_ClearSky_climatological(j,i,2) = epsilon_ClearSky_climatological(j,i,2) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,2) = predictors_epsilon_ClearSky_climatological(:,j,i,2) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Feb_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 3)                    epsilon_ClearSky_climatological(j,i,3) = epsilon_ClearSky_climatological(j,i,3) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,3) = predictors_epsilon_ClearSky_climatological(:,j,i,3) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Mar_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 4)                    epsilon_ClearSky_climatological(j,i,4) = epsilon_ClearSky_climatological(j,i,4) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,4) = predictors_epsilon_ClearSky_climatological(:,j,i,4) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Apr_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 5)                    epsilon_ClearSky_climatological(j,i,5) = epsilon_ClearSky_climatological(j,i,5) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,5) = predictors_epsilon_ClearSky_climatological(:,j,i,5) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_May_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 6)                    epsilon_ClearSky_climatological(j,i,6) = epsilon_ClearSky_climatological(j,i,6) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,6) = predictors_epsilon_ClearSky_climatological(:,j,i,6) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Jun_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 7)                    epsilon_ClearSky_climatological(j,i,7) = epsilon_ClearSky_climatological(j,i,7) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,7) = predictors_epsilon_ClearSky_climatological(:,j,i,7) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Jul_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 8)                    epsilon_ClearSky_climatological(j,i,8) = epsilon_ClearSky_climatological(j,i,8) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,8) = predictors_epsilon_ClearSky_climatological(:,j,i,8) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Aug_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 9)                    epsilon_ClearSky_climatological(j,i,9) = epsilon_ClearSky_climatological(j,i,9) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,9) = predictors_epsilon_ClearSky_climatological(:,j,i,9) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Sep_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 10)                    epsilon_ClearSky_climatological(j,i,10) = epsilon_ClearSky_climatological(j,i,10) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,10) = predictors_epsilon_ClearSky_climatological(:,j,i,10) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Oct_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                if(mod(k,12) == 11)                    epsilon_ClearSky_climatological(j,i,11) = epsilon_ClearSky_climatological(j,i,11) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                    predictors_epsilon_ClearSky_climatological(:,j,i,11) = predictors_epsilon_ClearSky_climatological(:,j,i,11) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Nov_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                end                                                               %else                %    epsilon_ClearSky_climatological(j,i,mod(k,12)) = epsilon_ClearSky_climatological(j,i,mod(k,12)) + Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k)/20.0;                %    predictors_epsilon_ClearSky_climatological(:,j,i,mod(k,12)) = predictors_epsilon_ClearSky_climatological(:,j,i,mod(k,12)) + [T_ERA5(j,i,k); RH_ERA5(j,i,k); Trop_Height_Zonal_Dec_mean(i); P_ERA5(j,i,k); Elevation_GMTED2010(j,i);  Area_EBAF_zonal(i)/360.0]./20.0;% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan'); mean(RH_ERA5(:,i,k))]./20.0;%                %end            %end        end    endendfor i=1:size_lat_EBAF    for j = 1:size_lon_EBAF        for k=1:12                                    counter = counter + 1;                                epsilon_ClearSky_climatological_list(counter) = epsilon_ClearSky_climatological(j,i,k);                predictors_epsilon_ClearSky_climatological_list(:,counter) = predictors_epsilon_ClearSky_climatological(:,j,i,k) ;                                    end    endendcounter = 0;for i=1:size_lat_EBAF    i    for j=1:size_lon_EBAF        for k = 1:252 %192 gives to 2016, 252 gives to 2022            if(RH_ERA5(j,i,k) > 0.0) %Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k) < 2.0 & Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k) > 0.2)                counter = counter + 1;                epsilon_ClearSky_total(counter) = Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k);                if(mod(k,12) == 0)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Dec_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0];% 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                                    end                if(mod(k,12) == 1)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k)  Trop_Height_Zonal_Jan_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 2)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Feb_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 3)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Mar_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 4)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Apr_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 5)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_May_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 6)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Jun_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)];%                end                if(mod(k,12) == 7)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Jul_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 8)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Aug_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 9)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Sep_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 10)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Oct_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end                if(mod(k,12) == 11)predictors_epsilon_ClearSky(:,counter) = [T_ERA5(j,i,k) RH_ERA5(j,i,k) Trop_Height_Zonal_Nov_mean(i) P_ERA5(j,i,k) Elevation_GMTED2010(j,i)  Area_EBAF_zonal(i)/360.0]; % 0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(k-8,i)]; %                end            end        end    endendepsilon_ClearSky_total = epsilon_ClearSky_total';predictors_epsilon_ClearSky = predictors_epsilon_ClearSky';%modelfunction_logpWV_CC=@(b,x) b(1) + b(2).*(x(:,2)) +b(3).*(x(:,3)) + b(4).*(x(:,1)) ;beta0 = [ 0.271639180097339 -0.0897023792964244 -0.00328985710160112 242.96374648106 ];beta0 = [ 0.0 0.0 0.0 250];mdl_logpWV_CC_coeffs = beta0;%[1.0 1.0 1.0 1.0];%Now for zonal monthly climatological meanscounter = 0;for i=1:size_lat_EBAF        for k = 1:12 %252 % 13:252 %192 %192 gives to 2016, 252 gives to 2022            %if(Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k) < 2.0 & Spatial_epsilon_ClearSky_EBAF_ERA5(j,i,k) > 0.2)           counter = counter + 1;            clear mean;            epsilon_ClearSky_total_zonal_mean(counter) = mean(mean(Spatial_epsilon_ClearSky_EBAF_ERA5(:,i,k:12:252),'omitnan'));           if(mod(k,12) == 0)                predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,12:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,12:12:252),'omitnan')) Trop_Height_Zonal_Dec_mean(i) mean(mean(P_ERA5(:,i,12:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+12:12:184),'omitnan'),'omitnan')]; %                           end                if(mod(k,12) == 1)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,1:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,1:12:252),'omitnan')) Trop_Height_Zonal_Jan_mean(i) mean(mean(P_ERA5(:,i,1:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 2)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,2:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,2:12:252),'omitnan')) Trop_Height_Zonal_Feb_mean(i) mean(mean(P_ERA5(:,i,2:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 3)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,3:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,3:12:252),'omitnan')) Trop_Height_Zonal_Mar_mean(i) mean(mean(P_ERA5(:,i,3:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 4)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,4:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,4:12:252),'omitnan')) Trop_Height_Zonal_Apr_mean(i) mean(mean(P_ERA5(:,i,4:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %T                end                if(mod(k,12) == 5)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,5:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,5:12:252),'omitnan')) Trop_Height_Zonal_May_mean(i) mean(mean(P_ERA5(:,i,5:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 6)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,6:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,6:12:252),'omitnan')) Trop_Height_Zonal_Jun_mean(i) mean(mean(P_ERA5(:,i,6:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 7)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,7:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,7:12:252),'omitnan')) Trop_Height_Zonal_Jul_mean(i) mean(mean(P_ERA5(:,i,7:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 8)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,8:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,8:12:252),'omitnan')) Trop_Height_Zonal_Aug_mean(i) mean(mean(P_ERA5(:,i,8:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 9)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,9:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,9:12:252),'omitnan')) Trop_Height_Zonal_Sep_mean(i) mean(mean(P_ERA5(:,i,9:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 10)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,10:12:252),'omitnan')) mean(mean(RH_ERA5(:,i,10:12:252),'omitnan')) Trop_Height_Zonal_Oct_mean(i) mean(mean(P_ERA5(:,i,10:12:252),'omitnan')) Elevation_GMTED2010(j,i)]; % mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end                if(mod(k,12) == 11)                    predictors_epsilon_ClearSky_zonal_mean(:,counter) = [mean(mean(T_ERA5(:,i,11:12:252),'omitnan'),'omitnan') mean(mean(RH_ERA5(:,i,11:12:252),'omitnan')) Trop_Height_Zonal_Nov_mean(i) mean(mean(P_ERA5(:,i,11:12:252),'omitnan')) Elevation_GMTED2010(j,i)];% mean(mean(0.001*ztrop_ROMSAF_radio_occultation_092001_to_122016(5+mod(k,12):12:184),i,'omitnan'),'omitnan')]; %                end           % end    end    endepsilon_ClearSky_total_zonal_mean = epsilon_ClearSky_total_zonal_mean';predictors_epsilon_ClearSky_zonal_mean = predictors_epsilon_ClearSky_zonal_mean';modelfunction_Ts=@(b,x) b(1) + b(3)*(x(:,2)) + b(2).*(x(:,1)) +b(5).*(x(:,3)-x(:,5)) + b(4).*x(:,4) ;i2 = 0;for i = 1:109    gamma = -1.4+0.05*(i-1)    if(gamma < 0.001 & gamma > -0.001)        gamma = 0.001;    end    modelfunction_Ts_gamma=@(b,x) b(1) + b(3)*(x(:,2)) + b(2).*(x(:,1)).^gamma +b(5).*(x(:,3)-x(:,5)) + b(4).*x(:,4) ;    mdl_spatial_climatological = fitnlm(predictors_epsilon_ClearSky_climatological_list', epsilon_ClearSky_climatological_list', modelfunction_Ts_gamma, [1.0 1.0 1.0 1.0 1.0])    if(mdl_spatial_climatological.Rsquared.Adjusted > 0.89)        i2 = i2 + 1;        mdl_spatial_coeffs(:,i2) = [mdl_spatial_climatological.Coefficients.Estimate; mdl_spatial_climatological.Rsquared.Adjusted; gamma; sqrt(mdl_spatial_climatological.MSE)]            if(gamma < 1.01 & gamma > 0.99)            i3 = i2;        end        if(gamma > -0.01 & gamma < 0.01)            i4 = i2;        end        if(gamma < 2.01 & gamma > 1.99)            i5 = i2;        end        depsilonClearSky_dT = mdl_spatial_coeffs(2,i2)*gamma.*T_ERA5.^(gamma - 1);        Spatial_lambda_WVLR_ClearSky =  -5.67e-8*(T_ERA5.^4).*depsilonClearSky_dT;        Spatial_lambda_WVLR_AllSky =  -5.67e-8*(1.0-Extracted_Cloud_Amount_EBAF+Extracted_Cloud_Amount_EBAF.*Spatial_c_epsilon_EBAF).*(T_ERA5.^4).*depsilonClearSky_dT;        depsilonClearSky_dT_4K = mdl_spatial_coeffs(2,i2)*gamma.*(T_ERA5_1940_1960_b_1deg_4K).^(gamma - 1);        depsilonClearSky_dT_2K = mdl_spatial_coeffs(2,i2)*gamma.*(T_ERA5_1940_1960_b_1deg_2K).^(gamma - 1);        Spatial_lambda_WVLR_ClearSky_4K =  -5.67e-8*((T_ERA5_1940_1960_1deg + DeltaT_4K_IPCC).^4).*depsilonClearSky_dT_4K;        Spatial_lambda_WVLR_AllSky_4K =  -5.67e-8*(1.0-Extracted_Cloud_Amount_EBAF+Extracted_Cloud_Amount_EBAF.*Spatial_c_epsilon_EBAF).*((T_ERA5_1940_1960_1deg + DeltaT_4K_IPCC).^4).*depsilonClearSky_dT_4K;        Spatial_lambda_WVLR_ClearSky_2K =  -5.67e-8*((T_ERA5_1940_1960_1deg + DeltaT_2K_IPCC).^4).*depsilonClearSky_dT_2K;        Spatial_lambda_WVLR_AllSky_2K =  -5.67e-8*(1.0-Extracted_Cloud_Amount_EBAF+Extracted_Cloud_Amount_EBAF.*Spatial_c_epsilon_EBAF).*((T_ERA5_1940_1960_1deg + DeltaT_2K_IPCC).^4).*depsilonClearSky_dT_2K;        Zonal_mean_lambda_WVLR_ClearSky_4K(:,i2) = mean(mean(Spatial_lambda_WVLR_ClearSky_4K),3);        Zonal_mean_lambda_WVLR_AllSky_4K(:,i2) = mean(mean(Spatial_lambda_WVLR_AllSky_4K),3);        Zonal_mean_lambda_WVLR_ClearSky_2K(:,i2) = mean(mean(Spatial_lambda_WVLR_ClearSky_2K),3);        Zonal_mean_lambda_WVLR_AllSky_2K(:,i2) = mean(mean(Spatial_lambda_WVLR_AllSky_2K),3);        Zonal_mean_lambda_WVLR_ClearSky(:,i2) = mean(mean(Spatial_lambda_WVLR_ClearSky),3);        Zonal_mean_lambda_WVLR_AllSky(:,i2) = mean(mean(Spatial_lambda_WVLR_AllSky),3);        lambda_WVLR_global_mean_AllSky_EBAF_ERA4_hist_weight_uncert(i2) = sum((mean(mean(Spatial_lambda_WVLR_AllSky,3,'omitnan').*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))        lambda_WVLR_global_mean_ClearSky_EBAF_ERA4_hist_weight_uncert(i2) = sum((mean(mean(Spatial_lambda_WVLR_ClearSky,3,'omitnan').*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                                         lambda_WVLR_global_mean_AllSky_EBAF_ERA4_hist_weight_uncert4K(i2) = sum((mean(mean(Spatial_lambda_WVLR_AllSky_4K,3,'omitnan').*DeltaT_4K_IPCC/4).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal));        lambda_WVLR_global_mean_ClearSky_EBAF_ERA4_hist_weight_uncert4K(i2) = sum((mean(mean(Spatial_lambda_WVLR_ClearSky_4K,3,'omitnan').*DeltaT_4K_IPCC/4).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal));                                                                                                                                                                  lambda_WVLR_global_mean_AllSky_EBAF_ERA4_hist_weight_uncert2K(i2) = sum((mean(mean(Spatial_lambda_WVLR_AllSky_2K,3,'omitnan').*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal));        lambda_WVLR_global_mean_ClearSky_EBAF_ERA4_hist_weight_uncert2K(i2) = sum((mean(mean(Spatial_lambda_WVLR_ClearSky_2K,3,'omitnan').*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal));                                                                                            gamma_uncert(i2) = gamma;                                                                                                                                                    end    enddepsilonClearSky_dT = mdl_spatial_coeffs(2,i3)*mdl_spatial_coeffs(7,i3).*T_ERA5.^(mdl_spatial_coeffs(7,i3) - 1);Spatial_lambda_WVLR_ClearSky =  -5.67e-8*(T_ERA5.^4).*depsilonClearSky_dT;Spatial_lambda_WVLR_AllSky =  -5.67e-8*(1.0-Extracted_Cloud_Amount_EBAF+Extracted_Cloud_Amount_EBAF.*Spatial_c_epsilon_EBAF).*(T_ERA5.^4).*depsilonClearSky_dT;Coefficients_lambda_gamma = polyfit(gamma_uncert(1:99), lambda_WVLR_global_mean_AllSky_EBAF_ERA4_hist_weight_uncert(1:99),3);                                                                                   Coefficients_lambda_gamma_2K = polyfit(gamma_uncert(1:99), lambda_WVLR_global_mean_AllSky_EBAF_ERA4_hist_weight_uncert2K(1:99),3);Coefficients_lambda_gamma_4K = polyfit(gamma_uncert(1:99), lambda_WVLR_global_mean_AllSky_EBAF_ERA4_hist_weight_uncert4K(1:99),3);                                                                                   gamma_pdf =  normpdf(gamma_uncert(1:99), 1.0 ,1.0);lambda_pdf_values = polyval(Coefficients_lambda_gamma, gamma_uncert(1:99),3);for i=1:98    delta_lambda(i) = lambda_pdf_values(i+1)-lambda_pdf_values(i);    Area_lambda_WVLR_pdf(i) = delta_lambda(i)*gamma_pdf(i);endArea_66percent = sum(Area_lambda_WVLR_pdf(i4:i5))lambda_pdf(1:98) = (0.66/Area_66percent)*gamma_pdf(1:98);%Zonal mean parameter valuesmdl_zonal_climatological = fitnlm(predictors_epsilon_ClearSky_zonal_mean, epsilon_ClearSky_total_zonal_mean, modelfunction_Ts, [mdl_spatial_coeffs(1,i3) mdl_spatial_coeffs(2,i3) mdl_spatial_coeffs(3,i3) mdl_spatial_coeffs(4,i3) mdl_spatial_coeffs(5,i3)])Spatial_lambda_WVLR_ClearSky2 = [Spatial_lambda_WVLR_ClearSky(:,:,:); Spatial_lambda_WVLR_ClearSky(1,:,:)];figure(707)subplot(4,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_ClearSky2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.5 2]);hold off;subplot(4,2,3)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_ClearSky2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.5 2]);hold off;subplot(4,2,5)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_ClearSky2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.5 2]);hold off;subplot(4,2,7)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_ClearSky2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.5 2]);hold off;Spatial_lambda_WVLR_AllSky2 = [Spatial_lambda_WVLR_AllSky(:,:,:); Spatial_lambda_WVLR_AllSky(1,:,:)];subplot(4,2,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_AllSky2(:,:,[linspace(1,241, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.5 2]);hold off;subplot(4,2,4)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_AllSky2(:,:,[linspace(4,244, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.5 2]);hold off;subplot(4,2,6)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_AllSky2(:,:,[linspace(7,247, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.5 2]);hold off;subplot(4,2,8)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_AllSky2(:,:,[linspace(10,250, 21)] ),3, 'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0.5 2]);hold off;Spatial_climatological_alpha_ClearSky_EBAF2 = [Spatial_climatological_alpha_ClearSky_EBAF(:,:,:); Spatial_climatological_alpha_ClearSky_EBAF(1,:,:)];figure(708)subplot(2,1,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', Spatial_climatological_alpha_ClearSky_EBAF2')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;Spatial_climatological_alpha_AllSky_EBAF2 = [Spatial_climatological_alpha_AllSky_EBAF(:,:,:); Spatial_climatological_alpha_AllSky_EBAF(1,:,:)];subplot(2,1,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', Spatial_climatological_alpha_AllSky_EBAF2')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 1]);hold off;%%%%%%T_fig709 = linspace(220, 320, 100);alpha_mean_Land_fig709 = linspace(0.0,0.0,100);alpha_mean_Ocean_fig709 = linspace(0.0,0.0,100);for(i=1:100)    alpha_mean_Land_fig709(i) = function_mean_alpha_T(T_fig709(i), Land_T_cold,Land_alpha_mean_cold, Land_T_warm,Land_alpha_mean_warm);    alpha_mean_Ocean_fig709(i) = function_mean_alpha_T(T_fig709(i), Ocean_T_cold,Ocean_alpha_mean_cold, Ocean_T_warm,Ocean_alpha_mean_warm);    alpha_mean_Land_fig709_erf(i) = (Land_alpha_mean_warm + Land_alpha_mean_cold)/2.0 - ((Land_alpha_mean_cold - Land_alpha_mean_warm)/2.0)*erf( (T_fig709(i) - (Land_T_cold + Land_T_warm)/2.0)/((Land_T_warm - Land_T_cold)/2.0)) ;    alpha_mean_Ocean_fig709_erf(i) = (Ocean_alpha_mean_warm + Ocean_alpha_mean_cold)/2.0 - ((Ocean_alpha_mean_cold - Ocean_alpha_mean_warm)/2.0)*erf( (T_fig709(i) - (Ocean_T_cold + Ocean_T_warm)/2.0)/((Ocean_T_warm - Ocean_T_cold)/2.0) ) ;endfigure(709)subplot(2,1,1)hold on;scatter(Land_T_ERA5_climatological, Land_alpha_climatological_ClearSky)scatter( Ocean_T_ERA5_climatological, Ocean_alpha_climatological_ClearSky )hold off;subplot(2,1,2)hold on;scatter(Land_T_ERA5_climatological, Land_alpha_planetary_mean)scatter(Ocean_T_ERA5_climatological, Ocean_alpha_planetary_mean)plot(T_fig709,alpha_mean_Land_fig709_erf, T_fig709, alpha_mean_Ocean_fig709_erf)hold off;%Calculate land and ocean lambda_albedo for clear sky and all skyfor i=1:size_lon_EBAF    for j=1:size_lat_EBAF        if(Land_Mask(i,j)>0.5) %land            dalpha_ClearSky_dT(i,j) = function_getdalpha_ClearSky_dT(Spatial_climatological_T_ERA5(i,j), Land_T_cold,Land_alpha_mean_cold, Land_T_warm,Land_alpha_mean_warm, beta_ClearSky, phi_rad_EBAF(1,j)) ;            dalpha_ClearSky_dT_4K(i,j) = function_getdalpha_ClearSky_dT(T_ERA5_1940_1960_1deg(i,j) + DeltaT_4K_IPCC(i,j), Land_T_cold,Land_alpha_mean_cold, Land_T_warm,Land_alpha_mean_warm, beta_ClearSky, phi_rad_EBAF(1,j)) ;            dalpha_ClearSky_dT_2K(i,j) = function_getdalpha_ClearSky_dT(T_ERA5_1940_1960_1deg(i,j) + DeltaT_2K_IPCC(i,j), Land_T_cold,Land_alpha_mean_cold, Land_T_warm,Land_alpha_mean_warm, beta_ClearSky, phi_rad_EBAF(1,j)) ;        end        if(Land_Mask(i,j)<0.5) %ocean            dalpha_ClearSky_dT(i,j) = function_getdalpha_ClearSky_dT(Spatial_climatological_T_ERA5(i,j), Ocean_T_cold,Ocean_alpha_mean_cold, Ocean_T_warm, Ocean_alpha_mean_warm, beta_ClearSky, phi_rad_EBAF(1,j)) ;            dalpha_ClearSky_dT_4K(i,j) = function_getdalpha_ClearSky_dT(T_ERA5_1940_1960_1deg(i,j) + DeltaT_4K_IPCC(i,j), Ocean_T_cold,Ocean_alpha_mean_cold, Ocean_T_warm, Ocean_alpha_mean_warm, beta_ClearSky, phi_rad_EBAF(1,j)) ;            dalpha_ClearSky_dT_2K(i,j) = function_getdalpha_ClearSky_dT(T_ERA5_1940_1960_1deg(i,j) + DeltaT_2K_IPCC(i,j), Ocean_T_cold,Ocean_alpha_mean_cold, Ocean_T_warm, Ocean_alpha_mean_warm, beta_ClearSky, phi_rad_EBAF(1,j)) ;        end                Cloud_insolation_fraction_climatological(i,j) = mean(Extracted_S_in_EBAF(i,j,:).*Extracted_Cloud_Amount_EBAF(i,j,:),3,'omitnan')./mean(Extracted_S_in_EBAF(i,j,:),3,'omitnan');              %Should there be a beta_ClearSky by the 0.5* in the below two equations?%%%%%%%%%%%%%%%%%%        dalpha_CloudySky_dT(i,j) =(((1.0 - alpha_Cloud_EBAF_fit_mean)*(1.0 - mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(i,j,:),3,'omitnan')))/((1.0 - mean(Spatial_alpha_ClearSky_planetary_infer_EBAF(i,j,:),3,'omitnan')*alpha_Cloud_EBAF_fit_mean)^2))*(1/(1.0 + (beta_ClearSky*0.5*(3.0*sin(phi_rad_EBAF(j))*sin(phi_rad_EBAF(j))-1.0))))*dalpha_ClearSky_dT(i,j);        dalpha_AllSky_dT(i,j) =Cloud_insolation_fraction_climatological(i,j)*(((1.0 - alpha_Cloud_EBAF_fit_mean)*(1.0 - mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(i,j,:),3,'omitnan')))/((1.0 - mean(Spatial_alpha_ClearSky_planetary_infer_EBAF(i,j,:),3,'omitnan')*alpha_Cloud_EBAF_fit_mean)^2))*(1/(1.0 + (beta_ClearSky*0.5*(3.0*sin(phi_rad_EBAF(j))*sin(phi_rad_EBAF(j))-1.0))))*dalpha_ClearSky_dT(i,j) + (1.0 - Cloud_insolation_fraction_climatological(i,j))*dalpha_ClearSky_dT(i,j);                dalpha_CloudySky_dT_4K(i,j) =(((1.0 - alpha_Cloud_EBAF_fit_mean)*(1.0 - mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(i,j,:),3,'omitnan')))/((1.0 - mean(Spatial_alpha_ClearSky_planetary_infer_EBAF(i,j,:),3,'omitnan')*alpha_Cloud_EBAF_fit_mean)^2))*(1/(1.0 + (beta_ClearSky*0.5*(3.0*sin(phi_rad_EBAF(j))*sin(phi_rad_EBAF(j))-1.0))))*dalpha_ClearSky_dT_4K(i,j);                dalpha_CloudySky_dT_2K(i,j) =(((1.0 - alpha_Cloud_EBAF_fit_mean)*(1.0 - mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(i,j,:),3,'omitnan')))/((1.0 - mean(Spatial_alpha_ClearSky_planetary_infer_EBAF(i,j,:),3,'omitnan')*alpha_Cloud_EBAF_fit_mean)^2))*(1/(1.0 + (beta_ClearSky*0.5*(3.0*sin(phi_rad_EBAF(j))*sin(phi_rad_EBAF(j))-1.0))))*dalpha_ClearSky_dT_2K(i,j);        dalpha_AllSky_dT_4K(i,j) =Cloud_insolation_fraction_climatological(i,j)*(((1.0 - alpha_Cloud_EBAF_fit_mean)*(1.0 - mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(i,j,:),3,'omitnan')))/((1.0 - mean(Spatial_alpha_ClearSky_planetary_infer_EBAF(i,j,:),3,'omitnan')*alpha_Cloud_EBAF_fit_mean)^2))*(1/(1.0 + (beta_ClearSky*0.5*(3.0*sin(phi_rad_EBAF(j))*sin(phi_rad_EBAF(j))-1.0))))*dalpha_ClearSky_dT_4K(i,j) + (1.0 - Cloud_insolation_fraction_climatological(i,j))*dalpha_ClearSky_dT_4K(i,j);                dalpha_AllSky_dT_2K(i,j) =Cloud_insolation_fraction_climatological(i,j)*(((1.0 - alpha_Cloud_EBAF_fit_mean)*(1.0 - mean(Spatial_alpha_Cloud_EBAF_FromMean_ifda(i,j,:),3,'omitnan')))/((1.0 - mean(Spatial_alpha_ClearSky_planetary_infer_EBAF(i,j,:),3,'omitnan')*alpha_Cloud_EBAF_fit_mean)^2))*(1/(1.0 + (beta_ClearSky*0.5*(3.0*sin(phi_rad_EBAF(j))*sin(phi_rad_EBAF(j))-1.0))))*dalpha_ClearSky_dT_2K(i,j) + (1.0 - Cloud_insolation_fraction_climatological(i,j))*dalpha_ClearSky_dT_2K(i,j);        lambda_alpha_ClearSky_spatial_climatological(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_ClearSky_dT(i,j);        lambda_alpha_CloudySky_spatial_climatological(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_CloudySky_dT(i,j);        lambda_alpha_AllSky_spatial_climatological(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_AllSky_dT(i,j);                lambda_alpha_ClearSky_spatial_climatological_4K(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_ClearSky_dT_4K(i,j);        lambda_alpha_CloudySky_spatial_climatological_4K(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_CloudySky_dT_4K(i,j);        lambda_alpha_AllSky_spatial_climatological_4K(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_AllSky_dT_4K(i,j);                lambda_alpha_ClearSky_spatial_climatological_2K(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_ClearSky_dT_2K(i,j);        lambda_alpha_CloudySky_spatial_climatological_2K(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_CloudySky_dT_2K(i,j);        lambda_alpha_AllSky_spatial_climatological_2K(i,j) = - mean(Extracted_S_in_EBAF(i,j,:),3)*dalpha_AllSky_dT_2K(i,j);            endendlambda_alpha_ClearSky_spatial_climatological2 = [lambda_alpha_ClearSky_spatial_climatological(:,:,:); lambda_alpha_ClearSky_spatial_climatological(1,:,:)];figure(710)subplot(2,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', lambda_alpha_ClearSky_spatial_climatological2')plotm(coastlat,coastlon,'k','linewidth',1)%clim([0 3.7]);hold off;%subplot(3,1,2)%hold on;%worldmap ('world')%mlabel("off")%plabel("off")%pcolorm(Lat_EBAF', Lon_EBAF', lambda_alpha_CloudySky_spatial_climatological')%plotm(coastlat,coastlon,'k','linewidth',1)%clim([0 3.7]);%hold off;lambda_alpha_AllSky_spatial_climatological2 = [lambda_alpha_AllSky_spatial_climatological(:,:,:); lambda_alpha_AllSky_spatial_climatological(1,:,:)];subplot(2,2,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', lambda_alpha_AllSky_spatial_climatological2')plotm(coastlat,coastlon,'k','linewidth',1)%clim([0 3.7]);hold off;subplot(2,2,3)hold on;X=[latitude_CESM2', fliplr(latitude_CESM2')];Y=[lambda_A_ClearSky_CMIP6_15models_min, fliplr(lambda_A_ClearSky_CMIP6_15models_max)];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot(latitude_CESM2, lambda_A_ClearSky_CMIP6_15models_median)X=[rad2deg(phi_rad_EBAF), fliplr(rad2deg(phi_rad_EBAF))];Y=[(1-Fraction_error_dalpha_dT)*mean(lambda_alpha_ClearSky_spatial_climatological), fliplr((1+Fraction_error_dalpha_dT)*mean(lambda_alpha_ClearSky_spatial_climatological))];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot(rad2deg(phi_rad_EBAF), mean(lambda_alpha_ClearSky_spatial_climatological) )X=[rad2deg(phi_rad_EBAF), fliplr(rad2deg(phi_rad_EBAF))];Y=[(1-Fraction_error_dalpha_dT)*mean(lambda_alpha_ClearSky_spatial_climatological_4K), fliplr((1+Fraction_error_dalpha_dT)*mean(lambda_alpha_ClearSky_spatial_climatological_4K))];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot(rad2deg(phi_rad_EBAF), mean(lambda_alpha_ClearSky_spatial_climatological_4K) )X=[rad2deg(phi_rad_EBAF), fliplr(rad2deg(phi_rad_EBAF))];Y=[(1-Fraction_error_dalpha_dT)*mean(lambda_alpha_ClearSky_spatial_climatological_2K), fliplr((1+Fraction_error_dalpha_dT)*mean(lambda_alpha_ClearSky_spatial_climatological_2K))];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot(rad2deg(phi_rad_EBAF), mean(lambda_alpha_ClearSky_spatial_climatological_2K) )hold off;        subplot(2,2,4)hold on;X=[latitude_CESM2', fliplr(latitude_CESM2')];Y=[lambda_Albedo_CMIP6_15models_min, fliplr(lambda_Albedo_CMIP6_15models_max)];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot(latitude_CESM2, lambda_Albedo_CMIP6_15models_median)X=[rad2deg(phi_rad_EBAF), fliplr(rad2deg(phi_rad_EBAF))];Y=[(1-Fraction_error_dalpha_dT)*mean(lambda_alpha_AllSky_spatial_climatological), fliplr((1+Fraction_error_dalpha_dT)*mean(lambda_alpha_AllSky_spatial_climatological))];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot( rad2deg(phi_rad_EBAF), mean(lambda_alpha_AllSky_spatial_climatological))X=[rad2deg(phi_rad_EBAF), fliplr(rad2deg(phi_rad_EBAF))];Y=[(1-Fraction_error_dalpha_dT)*mean(lambda_alpha_AllSky_spatial_climatological_4K), fliplr((1+Fraction_error_dalpha_dT)*mean(lambda_alpha_AllSky_spatial_climatological_4K))];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot( rad2deg(phi_rad_EBAF), mean(lambda_alpha_AllSky_spatial_climatological_4K))X=[rad2deg(phi_rad_EBAF), fliplr(rad2deg(phi_rad_EBAF))];Y=[(1-Fraction_error_dalpha_dT)*mean(lambda_alpha_AllSky_spatial_climatological_2K), fliplr((1+Fraction_error_dalpha_dT)*mean(lambda_alpha_AllSky_spatial_climatological_2K))];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot( rad2deg(phi_rad_EBAF), mean(lambda_alpha_AllSky_spatial_climatological_2K))hold off;   Spatial_lambda_WVLR_ClearSky2 = [Spatial_lambda_WVLR_ClearSky(:,:,:); Spatial_lambda_WVLR_ClearSky(1,:,:)];figure(712)subplot(2,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_ClearSky2,3,'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 2.5]);hold off;   Spatial_lambda_WVLR_AllSky2 = [Spatial_lambda_WVLR_AllSky(:,:,:); Spatial_lambda_WVLR_AllSky(1,:,:)];     subplot(2,2,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_AllSky2,3,'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 2.5]);hold off;        subplot(2,2,3)hold on;X=[rad2deg(phi_rad_EBAF), fliplr(rad2deg(phi_rad_EBAF))];Y=[Zonal_mean_lambda_WVLR_ClearSky(:,i4)', fliplr(Zonal_mean_lambda_WVLR_ClearSky(:,i5)')];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot(rad2deg(phi_rad_EBAF), mean(mean(Spatial_lambda_WVLR_ClearSky,3,'omitnan'))')hold off;subplot(2,2,4)hold on;X=[latitude_CESM2', fliplr(latitude_CESM2')];Y=[lambda_WVLR_CMIP6_15models_min, fliplr(lambda_WVLR_CMIP6_15models_max)];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot(latitude_CESM2, lambda_WVLR_CMIP6_15models_median)X=[rad2deg(phi_rad_EBAF), fliplr(rad2deg(phi_rad_EBAF))];Y=[Zonal_mean_lambda_WVLR_AllSky(:,i4)', fliplr(Zonal_mean_lambda_WVLR_AllSky(:,i5)')];h2 = fill(X,Y, 'k', 'facealpha', 0.2);plot(rad2deg(phi_rad_EBAF), mean(mean(Spatial_lambda_WVLR_AllSky,3,'omitnan'))')hold off;        lambda_Planck_global_mean_AllSky_EBAF_ERA5 = - sum(4.0*( mean(mean(5.67e-8*Spatial_epsilon_AllSky_EBAF_ERA5.*T_ERA5.^3,3)).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                        lambda_WVLR_global_mean_AllSky_EBAF_ERA4 = sum((mean(mean(Spatial_lambda_WVLR_AllSky,3,'omitnan')).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                lambda_WVLR_global_mean_ClearSky_EBAF_ERA4 = sum((mean(mean(Spatial_lambda_WVLR_ClearSky,3,'omitnan')).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))lambda_albedo_global_mean_AllSky_EBAF_ERA4 = sum((mean(mean(lambda_alpha_AllSky_spatial_climatological,3)).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))lambda_albedo_global_mean_ClearSky_EBAF_ERA4 = sum((mean(mean(lambda_alpha_ClearSky_spatial_climatological,3)).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                    lambda_Planck_global_mean_AllSky_EBAF_ERA5_hist_weight = - sum(4.0*( mean(mean(5.67e-8*Spatial_epsilon_AllSky_EBAF_ERA5.*T_ERA5.^3,3).*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                    lambda_Planck_global_mean_AllSky_EBAF_ERA5_hist_weight_2K = - sum(4.0*( mean(mean(5.67e-8*(Spatial_epsilon_AllSky_EBAF_ERA5 - (1.0-Extracted_Cloud_Amount_EBAF+Extracted_Cloud_Amount_EBAF.*Spatial_c_epsilon_EBAF).*depsilonClearSky_dT_2K.*((T_ERA5_1940_1960_1deg + DeltaT_2K_IPCC) - mean(T_ERA5,3))).*(T_ERA5_1940_1960_1deg + DeltaT_2K_IPCC).^3,3).*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                       lambda_Planck_global_mean_AllSky_EBAF_ERA5_hist_weight_4K = - sum(4.0*( mean(mean(5.67e-8*(Spatial_epsilon_AllSky_EBAF_ERA5 - (1.0-Extracted_Cloud_Amount_EBAF+Extracted_Cloud_Amount_EBAF.*Spatial_c_epsilon_EBAF).*depsilonClearSky_dT_4K.*((T_ERA5_1940_1960_1deg + DeltaT_4K_IPCC) - mean(T_ERA5,3))).*(T_ERA5_1940_1960_1deg + DeltaT_4K_IPCC).^3,3).*DeltaT_4K_IPCC/4).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                       lambda_WVLR_global_mean_AllSky_EBAF_ERA5_hist_weight = sum((mean(mean(Spatial_lambda_WVLR_AllSky,3,'omitnan').*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                                                    lambda_WVLR_global_mean_ClearSky_EBAF_ERA5_hist_weight = sum((mean(mean(Spatial_lambda_WVLR_ClearSky,3,'omitnan').*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))lambda_albedo_global_mean_AllSky_EBAF_ERA5_hist_weight = sum((mean(mean(lambda_alpha_AllSky_spatial_climatological,3).*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))lambda_albedo_global_mean_ClearSky_EBAF_ERA5_hist_weight = sum((mean(mean(lambda_alpha_ClearSky_spatial_climatological,3).*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                lambda_albedo_global_mean_AllSky_EBAF_ERA5_hist_weight_4K = sum((mean(mean(lambda_alpha_AllSky_spatial_climatological_4K,3).*DeltaT_4K_IPCC/4).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                 lambda_albedo_global_mean_AllSky_EBAF_ERA5_hist_weight_2K = sum((mean(mean(lambda_alpha_AllSky_spatial_climatological_2K,3).*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))lambda_albedo_global_mean_ClearSky_EBAF_ERA5_hist_weight_4K = sum((mean(mean(lambda_alpha_ClearSky_spatial_climatological_4K,3).*DeltaT_4K_IPCC/4).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                lambda_albedo_global_mean_ClearSky_EBAF_ERA5_hist_weight_2K = sum((mean(mean(lambda_alpha_ClearSky_spatial_climatological_2K,3).*DeltaT_2K_IPCC/2).*Area_EBAF_zonal'))/(sum(Area_EBAF_zonal))                                                                                                                        lambda_Planck_spatial_climatological_AllSky_EBAF_ERA5 = - (mean(4.0 * 5.67e-8*Spatial_epsilon_AllSky_EBAF_ERA5.*T_ERA5.^3,3));lambda_Planck_spatial_climatological_ClearSky_EBAF_ERA5 = - (mean(4.0 * 5.67e-8*Spatial_epsilon_ClearSky_EBAF_ERA5.*T_ERA5.^3,3));    lambda_Planck_spatial_climatological_ClearSky_EBAF_ERA52 = [lambda_Planck_spatial_climatological_ClearSky_EBAF_ERA5(:,:,:); lambda_Planck_spatial_climatological_ClearSky_EBAF_ERA5(1,:,:)];lambda_Planck_spatial_climatological_AllSky_EBAF_ERA52 = [lambda_Planck_spatial_climatological_AllSky_EBAF_ERA5(:,:,:); lambda_Planck_spatial_climatological_AllSky_EBAF_ERA5(1,:,:)];figure(713)subplot(3,1,1)hold on;worldmap ('world')mlabel("off") %plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', lambda_Planck_spatial_climatological_ClearSky_EBAF_ERA52' + mean(Spatial_lambda_WVLR_ClearSky2,3,'omitnan')' + lambda_alpha_ClearSky_spatial_climatological2')plotm(coastlat,coastlon,'k','linewidth',1)clim([-4 4]);hold off;subplot(3,1,2)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', lambda_Planck_spatial_climatological_AllSky_EBAF_ERA52' + mean(Spatial_lambda_WVLR_AllSky2,3,'omitnan')' + lambda_alpha_AllSky_spatial_climatological2')plotm(coastlat,coastlon,'k','linewidth',1)clim([-4 4]); hold off;subplot(3,1,3)plot(rad2deg(phi_rad_EBAF), mean(lambda_Planck_spatial_climatological_ClearSky_EBAF_ERA5 + mean(Spatial_lambda_WVLR_ClearSky,3,'omitnan') + lambda_alpha_ClearSky_spatial_climatological), rad2deg(phi_rad_EBAF), mean(lambda_Planck_spatial_climatological_AllSky_EBAF_ERA5 + mean(Spatial_lambda_WVLR_AllSky,3,'omitnan') + lambda_alpha_AllSky_spatial_climatological))                                                    figure(711)subplot(4,2,1)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', lambda_Planck_spatial_climatological_AllSky_EBAF_ERA52')plotm(coastlat,coastlon,'k','linewidth',1)clim([-3 -2]);hold off;subplot(4,2,3)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', mean(Spatial_lambda_WVLR_AllSky2,3,'omitnan')')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 2.5]);hold off;subplot(4,2,5)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', lambda_alpha_AllSky_spatial_climatological2')plotm(coastlat,coastlon,'k','linewidth',1)clim([0 7]);;hold off;        subplot(4,2,7)hold on;worldmap ('world')mlabel("off")%plabel("off")pcolorm(Lat_EBAF', Lon_EBAF2', lambda_Planck_spatial_climatological_AllSky_EBAF_ERA52' + mean(Spatial_lambda_WVLR_AllSky2,3,'omitnan')' + lambda_alpha_AllSky_spatial_climatological2' )plotm(coastlat,coastlon,'k','linewidth',1)clim([-3 3]);hold off;subplot(4,2,2)plot(mean(lambda_Planck_spatial_climatological_AllSky_EBAF_ERA5), rad2deg(phi_rad_EBAF)  )subplot(4,2,4)plot(mean(mean(Spatial_lambda_WVLR_AllSky,3,'omitnan')), rad2deg(phi_rad_EBAF)  )subplot(4,2,6)plot( mean(lambda_alpha_AllSky_spatial_climatological), rad2deg(phi_rad_EBAF))subplot(4,2,8)plot( mean(lambda_Planck_spatial_climatological_AllSky_EBAF_ERA5 + mean(Spatial_lambda_WVLR_AllSky,3,'omitnan') + lambda_alpha_AllSky_spatial_climatological), rad2deg(phi_rad_EBAF))                %Now calculate pdfs for lambda_WVLR, lambda_albedo and lambda_total_non-cloudfor i=1:3e7    lambda_albedo_global_dist(i) = (1-normrnd(0.0,Fraction_error_dalpha_dT))*lambda_albedo_global_mean_AllSky_EBAF_ERA5_hist_weight;    lambda_albedo_global_dist_2K(i) = (1-normrnd(0.0,Fraction_error_dalpha_dT))*lambda_albedo_global_mean_AllSky_EBAF_ERA5_hist_weight_2K;    lambda_albedo_global_dist_4K(i) = (1-normrnd(0.0,Fraction_error_dalpha_dT))*lambda_albedo_global_mean_AllSky_EBAF_ERA5_hist_weight_4K;    lambda_WVLR_global_dist(i) = polyval(Coefficients_lambda_gamma, normrnd(1.0,1.0),3);    lambda_WVLR_global_dist_2K(i) = polyval(Coefficients_lambda_gamma_2K, normrnd(1.0,1.0),3);    lambda_WVLR_global_dist_4K(i) = polyval(Coefficients_lambda_gamma_4K, normrnd(1.0,1.0),3);    lambda_cloud_Ceppi_Nowack = normrnd(0.43, 0.35/1.645);                    lambda_net_dist_2K(i) = lambda_albedo_global_dist_2K(i) + lambda_WVLR_global_dist_2K(i) + lambda_Planck_global_mean_AllSky_EBAF_ERA5_hist_weight_2K + lambda_cloud_Ceppi_Nowack;    ECS_net_dist_2K(i) = -normrnd(3.8,0.38/1.645) / lambda_net_dist_2K(i); %instantaneous radiative forcing, since other adjustments are accounted for in the lambda term.                    lambda_net_dist(i) = lambda_albedo_global_dist(i) + lambda_WVLR_global_dist(i) + lambda_Planck_global_mean_AllSky_EBAF_ERA5_hist_weight + lambda_cloud_Ceppi_Nowack;    ECS_net_dist(i) = -normrnd(3.8,0.38/1.645) / lambda_net_dist(i);                    lambda_net_dist_4K(i) = lambda_albedo_global_dist_4K(i) + lambda_WVLR_global_dist_4K(i) + lambda_Planck_global_mean_AllSky_EBAF_ERA5_hist_weight_4K + lambda_cloud_Ceppi_Nowack;                ECS_net_dist_4K(i) = -normrnd(3.8,0.38/1.645) / lambda_net_dist_4K(i);                end              Number_bins = 20000edges_lambda_total = linspace(-100, 100, Number_bins+1);edges_ECS_total = linspace(-100, 100, Number_bins+1);[counts_lambda_total, edges_lambda_total] = histcounts(lambda_net_dist, edges_lambda_total);[counts_ECS_total, edges_ECS_total] = histcounts(ECS_net_dist, edges_ECS_total);[counts_lambda_total_2K, edges_lambda_total] = histcounts(lambda_net_dist_2K, edges_lambda_total);[counts_ECS_total_2K, edges_ECS_total] = histcounts(ECS_net_dist_2K, edges_ECS_total);[counts_lambda_total_4K, edges_lambda_total] = histcounts(lambda_net_dist_4K, edges_lambda_total);[counts_ECS_total_4K, edges_ECS_total] = histcounts(ECS_net_dist_4K, edges_ECS_total);for i = 1:Number_bins    lambda_centres(i) = 0.5*(edges_lambda_total(i) + edges_lambda_total(i+1));    ECS_centres(i) = 0.5*(edges_ECS_total(i) + edges_ECS_total(i+1));end         ECS_Sherwood_baseline;lambda_pdf = (1/(0.01*3e7))*counts_lambda_total;lambda_pdf_2K = (1/(0.01*3e7))*counts_lambda_total_2K;lambda_pdf_4K = (1/(0.01*3e7))*counts_lambda_total_4K;ECS_pdf = (1/(0.01*3e7))*counts_ECS_total;ECS_pdf_2K = (1/(0.01*3e7))*counts_ECS_total_2K;ECS_pdf_4K = (1/(0.01*3e7))*counts_ECS_total_4K;ECS_pdf_convolution_with_baseline = ((1/(0.01*3e7))*ECS_Sherwood_baseline_pdf'.*counts_ECS_total)/sum(0.01*(1/(0.01*3e7))*ECS_Sherwood_baseline_pdf'.*counts_ECS_total);ECS_pdf_convolution_with_baseline_2K = ((1/(0.01*3e7))*ECS_Sherwood_baseline_pdf'.*counts_ECS_total_2K)/sum(0.01*(1/(0.01*3e7))*ECS_Sherwood_baseline_pdf'.*counts_ECS_total_2K);ECS_pdf_convolution_with_baseline_4K = ((1/(0.01*3e7))*ECS_Sherwood_baseline_pdf'.*counts_ECS_total_4K)/sum(0.01*(1/(0.01*3e7))*ECS_Sherwood_baseline_pdf'.*counts_ECS_total_4K);lambda_cdf = linspace(0.0,0.0,Number_bins);lambda_cdf_2K = linspace(0.0,0.0,Number_bins);lambda_cdf_4K = linspace(0.0,0.0,Number_bins);ECS_cdf = linspace(0.0,0.0,Number_bins);ECS_cdf_2K = linspace(0.0,0.0,Number_bins);ECS_cdf_4K = linspace(0.0,0.0,Number_bins);ECS_cdf_convolution_with_baseline = linspace(0.0,0.0,Number_bins);ECS_cdf_convolution_with_baseline_2K = linspace(0.0,0.0,Number_bins);ECS_cdf_convolution_with_baseline_4K = linspace(0.0,0.0,Number_bins);lambda_cdf = linspace(0.0,0.0,Number_bins);lambda_cdf_2K = linspace(0.0,0.0,Number_bins);lambda_cdf_4K = linspace(0.0,0.0,Number_bins);ECS_cdf = linspace(0.0,0.0,Number_bins);ECS_cdf_2K = linspace(0.0,0.0,Number_bins);ECS_cdf_4K = linspace(0.0,0.0,Number_bins);ECS_cdf_convolution_with_baseline = linspace(0.0,0.0,Number_bins);ECS_cdf_convolution_with_baseline_2K = linspace(0.0,0.0,Number_bins);ECS_cdf_convolution_with_baseline_4K = linspace(0.0,0.0,Number_bins);ECS_cdf_baseline = linspace(0.0,0.0,Number_bins);for i=2:Number_bins    lambda_cdf(i) = lambda_cdf(i-1) + 0.01*lambda_pdf(i);    lambda_cdf_2K(i) = lambda_cdf_2K(i-1) + 0.01*lambda_pdf_2K(i);    lambda_cdf_4K(i) = lambda_cdf_4K(i-1) + 0.01*lambda_pdf_4K(i);    ECS_cdf(i) = ECS_cdf(i-1) + 0.01*ECS_pdf(i);    ECS_cdf_2K(i) = ECS_cdf_2K(i-1) + 0.01*ECS_pdf_2K(i);    ECS_cdf_4K(i) = ECS_cdf_4K(i-1) + 0.01*ECS_pdf_4K(i);    ECS_cdf_convolution_with_baseline(i) = ECS_cdf_convolution_with_baseline(i-1) + 0.01*ECS_pdf_convolution_with_baseline(i);    ECS_cdf_convolution_with_baseline_2K(i) = ECS_cdf_convolution_with_baseline_2K(i-1) + 0.01*ECS_pdf_convolution_with_baseline_2K(i);    ECS_cdf_convolution_with_baseline_4K(i) = ECS_cdf_convolution_with_baseline_4K(i-1) + 0.01*ECS_pdf_convolution_with_baseline_4K(i);    ECS_cdf_baseline(i) = ECS_cdf_baseline(i-1) + 0.01*ECS_Sherwood_baseline_pdf(i);            end[~, i_B_83 ] = min( abs( ECS_cdf_baseline-0.83 ) );[~, i_B_17 ] = min( abs( ECS_cdf_baseline-0.17 ) );[~, i_B_50 ] = min( abs( ECS_cdf_baseline-0.50 ) );[~, i_B_05 ] = min( abs( ECS_cdf_baseline-0.05 ) );[~, i_B_95 ] = min( abs( ECS_cdf_baseline-0.95 ) );[~, i_C2K_83 ] = min( abs( ECS_cdf_convolution_with_baseline_2K-0.83 ) );[~, i_C2K_17 ] = min( abs( ECS_cdf_convolution_with_baseline_2K-0.17 ) );[~, i_C2K_50 ] = min( abs( ECS_cdf_convolution_with_baseline_2K-0.50 ) );[~, i_C2K_05 ] = min( abs( ECS_cdf_convolution_with_baseline_2K-0.05 ) );[~, i_C2K_95 ] = min( abs( ECS_cdf_convolution_with_baseline_2K-0.95 ) );[~, i_C4K_83 ] = min( abs( ECS_cdf_convolution_with_baseline_4K-0.83 ) );[~, i_C4K_17 ] = min( abs( ECS_cdf_convolution_with_baseline_4K-0.17 ) );[~, i_C4K_50 ] = min( abs( ECS_cdf_convolution_with_baseline_4K-0.50 ) );[~, i_C4K_05 ] = min( abs( ECS_cdf_convolution_with_baseline_4K-0.05 ) );[~, i_C4K_95 ] = min( abs( ECS_cdf_convolution_with_baseline_4K-0.95 ) );[~, i_C_83 ] = min( abs( ECS_cdf_convolution_with_baseline-0.83 ) );[~, i_C_17 ] = min( abs( ECS_cdf_convolution_with_baseline-0.17 ) );[~, i_C_50 ] = min( abs( ECS_cdf_convolution_with_baseline-0.50 ) );[~, i_C_05 ] = min( abs( ECS_cdf_convolution_with_baseline-0.05 ) );[~, i_C_95 ] = min( abs( ECS_cdf_convolution_with_baseline-0.95 ) );[~, i_2K_83 ] = min( abs( ECS_cdf_2K-0.83 ) );[~, i_2K_17 ] = min( abs( ECS_cdf_2K-0.17 ) );[~, i_2K_50 ] = min( abs( ECS_cdf_2K-0.50 ) );[~, i_2K_05 ] = min( abs( ECS_cdf_2K-0.05 ) );[~, i_2K_95 ] = min( abs( ECS_cdf_2K-0.95 ) );[~, i_4K_83 ] = min( abs( ECS_cdf_4K-0.83 ) );[~, i_4K_17 ] = min( abs( ECS_cdf_4K-0.17 ) );[~, i_4K_50 ] = min( abs( ECS_cdf_4K-0.50 ) );[~, i_4K_05 ] = min( abs( ECS_cdf_4K-0.05 ) );[~, i_4K_95 ] = min( abs( ECS_cdf_4K-0.95 ) );[~, i_83 ] = min( abs( ECS_cdf-0.83 ) );[~, i_17 ] = min( abs( ECS_cdf-0.17 ) );[~, i_50 ] = min( abs( ECS_cdf-0.50 ) );[~, i_05 ] = min( abs( ECS_cdf-0.05 ) );[~, i_95 ] = min( abs( ECS_cdf-0.95 ) );[~, i_l2K_83 ] = min( abs( lambda_cdf_2K-0.83 ) );[~, i_l2K_17 ] = min( abs( lambda_cdf_2K-0.17 ) );[~, i_l2K_50 ] = min( abs( lambda_cdf_2K-0.50 ) );[~, i_l2K_05 ] = min( abs( lambda_cdf_2K-0.05 ) );[~, i_l2K_95 ] = min( abs( lambda_cdf_2K-0.95 ) );[~, i_l4K_83 ] = min( abs( lambda_cdf_4K-0.83 ) );[~, i_l4K_17 ] = min( abs( lambda_cdf_4K-0.17 ) );[~, i_l4K_50 ] = min( abs( lambda_cdf_4K-0.50 ) );[~, i_l4K_05 ] = min( abs( lambda_cdf_4K-0.05 ) );[~, i_l4K_95 ] = min( abs( lambda_cdf_4K-0.95 ) );[~, i_l83 ] = min( abs( lambda_cdf-0.83 ) );[~, i_l17 ] = min( abs( lambda_cdf-0.17 ) );[~, i_l50 ] = min( abs( lambda_cdf-0.50 ) );[~, i_l05 ] = min( abs( lambda_cdf-0.05 ) );[~, i_l95 ] = min( abs( lambda_cdf-0.95 ) );ECS_17th = ECS_centres(i_17)ECS_83rd = ECS_centres(i_83)ECS_50th = ECS_centres(i_50)ECS_05th = ECS_centres(i_05)ECS_95th = ECS_centres(i_95)ECS_2K_17th = ECS_centres(i_2K_17)ECS_2K_83rd = ECS_centres(i_2K_83)ECS_2K_50th = ECS_centres(i_2K_50)ECS_2K_05th = ECS_centres(i_2K_05)ECS_2K_95th = ECS_centres(i_2K_95)ECS_4K_17th = ECS_centres(i_4K_17)ECS_4K_83rd = ECS_centres(i_4K_83)ECS_4K_50th = ECS_centres(i_4K_50)ECS_4K_05th = ECS_centres(i_4K_05)ECS_4K_95th = ECS_centres(i_4K_95)ECS_C_17th = ECS_centres(i_C_17)ECS_C_83rd = ECS_centres(i_C_83)ECS_C_50th = ECS_centres(i_C_50)ECS_C_05th = ECS_centres(i_C_05)ECS_C_95th = ECS_centres(i_C_95)ECS_C2K_17th = ECS_centres(i_C2K_17)ECS_C2K_83rd = ECS_centres(i_C2K_83)ECS_C2K_50th = ECS_centres(i_C2K_50)ECS_C2K_05th = ECS_centres(i_C2K_05)ECS_C2K_95th = ECS_centres(i_C2K_95)ECS_C4K_17th = ECS_centres(i_C4K_17)ECS_C4K_83rd = ECS_centres(i_C4K_83)ECS_C4K_50th = ECS_centres(i_C4K_50)ECS_C4K_05th = ECS_centres(i_C4K_05)ECS_C4K_95th = ECS_centres(i_C4K_95)ECS_B_17th = ECS_centres(i_B_17)ECS_B_83rd = ECS_centres(i_B_83)ECS_B_50th = ECS_centres(i_B_50)ECS_B_05th = ECS_centres(i_B_05)ECS_B_95th = ECS_centres(i_B_95)        lambda_17th = ECS_centres(i_l17)lambda_83rd = lambda_centres(i_l83)lambda_50th = lambda_centres(i_l50)lambda_05th = lambda_centres(i_l05)lambda_95th = lambda_centres(i_l95)lambda_2K_17th = lambda_centres(i_l2K_17)lambda_2K_83rd = lambda_centres(i_l2K_83)lambda_2K_50th = lambda_centres(i_l2K_50)lambda_2K_05th = lambda_centres(i_l2K_05)lambda_2K_95th = lambda_centres(i_l2K_95)lambda_4K_17th = lambda_centres(i_l4K_17)lambda_4K_83rd = lambda_centres(i_l4K_83)lambda_4K_50th = lambda_centres(i_l4K_50)lambda_4K_05th = lambda_centres(i_l4K_05)lambda_4K_95th = lambda_centres(i_l4K_95)figure(304)subplot(3,1,1)plot(lambda_centres, lambda_pdf, lambda_centres, lambda_pdf_2K, lambda_centres, lambda_pdf_4K );subplot(3,1,2)plot(ECS_centres, ECS_pdf, ECS_centres, ECS_pdf_2K, ECS_centres, ECS_pdf_4K, ECS_centres, ECS_Sherwood_baseline_pdf');subplot(3,1,3)plot(ECS_centres, ECS_pdf_convolution_with_baseline, ECS_centres, ECS_pdf_convolution_with_baseline_2K, ECS_centres, ECS_pdf_convolution_with_baseline_4K, ECS_centres, ECS_Sherwood_baseline_pdf')        function mean_alpha = function_mean_alpha_T(Temp, a,b,c,d)    %define turning points (a,b) and (c,d)            k = -6.0*(b-d)/((a-c)*(a-c)*(a-c));    h = ((b+d)/2.0) - (( (b-d)*(a+c)*(a*a + c*c - 4.0*a*c) ) / (2.0*(a-c)*(a-c)*(a-c)) );    mean_alpha = d;        if(Temp > c)        mean_alpha = d;    end    if(Temp > a & Temp <= c)        mean_alpha = k*((Temp*Temp*Temp)/3.0 - (a+c)*Temp*Temp/2 + a*c*Temp) + h;    end    if(Temp <= a)        mean_alpha = b;    endendfunction surface_alpha = function_surface_alpha_phi(phi,  mean_alpha)    surface_alpha = mean_alpha*(1.0 + (1.0-mean_alpha)*(0.5*(3.0*sin (phi) * sin (phi) - 1.0)));endfunction depdT = get_depsilon_dT_RH(RH, T, sigma)    depdT = - (242.963746505882-sigma*10.011349140582)/(T.*T); end%Needs a betafunction dalpha_SurfaceClearSky_dT = function_getdalpha_ClearSky_dT_cubic(T, a,b,c,d, beta, phi)        %for cubic form    if(T < a)        dalpha_SurfaceClearSky_dT = 0.0;    end    if(T > c)        dalpha_SurfaceClearSky_dT = 0.0;    end    if (T >= a & T <= c)        k = -6.0*(b-d)/((a-c)*(a-c)*(a-c));        h = ((b+d)/2.0) - (( (b-d)*(a+c)*(a*a + c*c - 4.0*a*c) ) / (2.0*(a-c)*(a-c)*(a-c)) );        dMeanAlpha_dT = k*(T*T - (a+c)*T + a*c );        %For cubic form:        MeanAlpha = k*((T*T*T)/3.0 - (a+c)*T*T/2 + a*c*T) + h;        dalpha_SurfaceClearSky_dT = dMeanAlpha_dT * (1.0 +  beta*(0.5*(3.0*sin(phi)*sin(phi) - 1.0))*(1-2.0*MeanAlpha) );    endend        function dalpha_SurfaceClearSky_dT = function_getdalpha_ClearSky_dT(T, TC,AC,TW,AW, beta, phi)                        %for error function form            dMeanAlpha_dT = -(2.0/sqrt(pi()))*(((AC - AW))/2.0)*(1.0/(((TW - TC)/2.0))) *exp(-((T - (TW + TC)/2.0)/((TW - TC)/2.0)).^2);    MeanAlpha = (AC + AW)/2.0 - ((AC - AW))/2.0*erf( (T - (TW + TC)/2.0)/((TW - TC)/2.0)) ;    %Check this ...        dalpha_SurfaceClearSky_dT = dMeanAlpha_dT * (1.0 +  beta*(0.5*(3.0*sin(phi)*sin(phi) - 1.0)));%*(1-2.0*MeanAlpha) );            end